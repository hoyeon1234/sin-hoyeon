<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.280">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>HIHO – rl2-tdsarsaq-learn</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-JE4129QJZV"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-JE4129QJZV', { 'anonymize_ip': true});
</script>
<meta name="google-site-verification" content="Dxb4yHeHMq4MFutu7SWlCRabUxs5bbRmpirOQOrCXRY">

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title">HIHO</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../about.html">
 <span class="menu-text">About me</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/hoyeon1234"><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#greed-world-problem" id="toc-greed-world-problem" class="nav-link active" data-scroll-target="#greed-world-problem">Greed World Problem</a>
  <ul class="collapse">
  <li><a href="#true-value-function-v_pi" id="toc-true-value-function-v_pi" class="nav-link" data-scroll-target="#true-value-function-v_pi">True Value function <span class="math inline">\(v_\pi\)</span></a></li>
  <li><a href="#optimal-action-value-function-q_star" id="toc-optimal-action-value-function-q_star" class="nav-link" data-scroll-target="#optimal-action-value-function-q_star">Optimal action value function, <span class="math inline">\(q_{\star}\)</span></a></li>
  </ul></li>
  <li><a href="#set-up" id="toc-set-up" class="nav-link" data-scroll-target="#set-up">Set up</a></li>
  <li><a href="#td_prediction" id="toc-td_prediction" class="nav-link" data-scroll-target="#td_prediction">TD_Prediction</a>
  <ul class="collapse">
  <li><a href="#strategy1" id="toc-strategy1" class="nav-link" data-scroll-target="#strategy1">strategy1</a></li>
  <li><a href="#strategy2" id="toc-strategy2" class="nav-link" data-scroll-target="#strategy2">strategy2</a></li>
  </ul></li>
  <li><a href="#sarsaon-policy-td-control" id="toc-sarsaon-policy-td-control" class="nav-link" data-scroll-target="#sarsaon-policy-td-control">SARSA(On-Policy TD Control)</a></li>
  <li><a href="#q-learning" id="toc-q-learning" class="nav-link" data-scroll-target="#q-learning">Q-learning</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">



<section id="greed-world-problem" class="level1">
<h1>Greed World Problem</h1>
<p><img src="./ex4-1.png" class="img-fluid"></p>
<ul>
<li><span class="math inline">\(\mathcal{S} = \{[0,0],[0,1],...,[3,3]\}\)</span></li>
<li><span class="math inline">\(\mathcal{A}(s) = \{\text{up,down,right,left}\}\)</span></li>
<li><span class="math inline">\(R_t = -1\)</span></li>
<li><span class="math inline">\(\gamma = 1\)</span></li>
<li>Deterministically cause the corresponding state transitions</li>
<li>The actions that would take the agent off the grid in fact leave the state unchanged.</li>
<li>undiscounted, episodic task</li>
</ul>
<section id="true-value-function-v_pi" class="level2">
<h2 class="anchored" data-anchor-id="true-value-function-v_pi">True Value function <span class="math inline">\(v_\pi\)</span></h2>
<ul>
<li><span class="math inline">\(\forall s,\forall a : \pi(a|s) = 0.25\)</span></li>
</ul>
<p><img src="./ex4-2.png" class="img-fluid"></p>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="im">import</span> time</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1"></a>np.array ([[  <span class="dv">0</span>,<span class="op">-</span><span class="dv">14</span>,<span class="op">-</span><span class="dv">20</span> ,<span class="op">-</span><span class="dv">22</span>],</span>
<span id="cb2-2"><a href="#cb2-2"></a>           [<span class="op">-</span><span class="dv">14</span>, <span class="op">-</span><span class="dv">18</span>, <span class="op">-</span><span class="dv">20</span>, <span class="op">-</span><span class="dv">20</span>],</span>
<span id="cb2-3"><a href="#cb2-3"></a>           [<span class="op">-</span><span class="dv">20</span>, <span class="op">-</span><span class="dv">20</span>, <span class="op">-</span><span class="dv">18</span>, <span class="op">-</span><span class="fl">14.</span>],</span>
<span id="cb2-4"><a href="#cb2-4"></a>           [<span class="op">-</span><span class="dv">22</span>, <span class="op">-</span><span class="dv">20</span>, <span class="op">-</span><span class="dv">14</span>,   <span class="fl">0.</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<pre><code>array([[  0., -14., -20., -22.],
       [-14., -18., -20., -20.],
       [-20., -20., -18., -14.],
       [-22., -20., -14.,   0.]])</code></pre>
</div>
</div>
</section>
<section id="optimal-action-value-function-q_star" class="level2">
<h2 class="anchored" data-anchor-id="optimal-action-value-function-q_star">Optimal action value function, <span class="math inline">\(q_{\star}\)</span></h2>
<p><img src="./ex4-3.png" class="img-fluid"></p>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1"></a>q_star <span class="op">=</span> {((<span class="dv">0</span>, <span class="dv">0</span>), <span class="st">'W'</span>): <span class="dv">0</span>,</span>
<span id="cb4-2"><a href="#cb4-2"></a> ((<span class="dv">0</span>, <span class="dv">0</span>), <span class="st">'E'</span>): <span class="dv">0</span>,</span>
<span id="cb4-3"><a href="#cb4-3"></a> ((<span class="dv">0</span>, <span class="dv">0</span>), <span class="st">'N'</span>): <span class="dv">0</span>,</span>
<span id="cb4-4"><a href="#cb4-4"></a> ((<span class="dv">0</span>, <span class="dv">0</span>), <span class="st">'S'</span>): <span class="dv">0</span>,</span>
<span id="cb4-5"><a href="#cb4-5"></a> ((<span class="dv">0</span>, <span class="dv">1</span>), <span class="st">'W'</span>): <span class="op">-</span><span class="fl">1.0</span>,</span>
<span id="cb4-6"><a href="#cb4-6"></a> ((<span class="dv">0</span>, <span class="dv">1</span>), <span class="st">'E'</span>): <span class="op">-</span><span class="fl">3.0</span>,</span>
<span id="cb4-7"><a href="#cb4-7"></a> ((<span class="dv">0</span>, <span class="dv">1</span>), <span class="st">'N'</span>): <span class="op">-</span><span class="fl">2.0</span>,</span>
<span id="cb4-8"><a href="#cb4-8"></a> ((<span class="dv">0</span>, <span class="dv">1</span>), <span class="st">'S'</span>): <span class="op">-</span><span class="fl">3.0</span>,</span>
<span id="cb4-9"><a href="#cb4-9"></a> ((<span class="dv">0</span>, <span class="dv">2</span>), <span class="st">'W'</span>): <span class="op">-</span><span class="fl">2.0</span>,</span>
<span id="cb4-10"><a href="#cb4-10"></a> ((<span class="dv">0</span>, <span class="dv">2</span>), <span class="st">'E'</span>): <span class="op">-</span><span class="fl">4.0</span>,</span>
<span id="cb4-11"><a href="#cb4-11"></a> ((<span class="dv">0</span>, <span class="dv">2</span>), <span class="st">'N'</span>): <span class="op">-</span><span class="fl">3.0</span>,</span>
<span id="cb4-12"><a href="#cb4-12"></a> ((<span class="dv">0</span>, <span class="dv">2</span>), <span class="st">'S'</span>): <span class="op">-</span><span class="fl">4.0</span>,</span>
<span id="cb4-13"><a href="#cb4-13"></a> ((<span class="dv">0</span>, <span class="dv">3</span>), <span class="st">'W'</span>): <span class="op">-</span><span class="fl">3.0</span>,</span>
<span id="cb4-14"><a href="#cb4-14"></a> ((<span class="dv">0</span>, <span class="dv">3</span>), <span class="st">'E'</span>): <span class="op">-</span><span class="fl">4.0</span>,</span>
<span id="cb4-15"><a href="#cb4-15"></a> ((<span class="dv">0</span>, <span class="dv">3</span>), <span class="st">'N'</span>): <span class="op">-</span><span class="fl">4.0</span>,</span>
<span id="cb4-16"><a href="#cb4-16"></a> ((<span class="dv">0</span>, <span class="dv">3</span>), <span class="st">'S'</span>): <span class="op">-</span><span class="fl">3.0</span>,</span>
<span id="cb4-17"><a href="#cb4-17"></a> ((<span class="dv">1</span>, <span class="dv">0</span>), <span class="st">'W'</span>): <span class="op">-</span><span class="fl">2.0</span>,</span>
<span id="cb4-18"><a href="#cb4-18"></a> ((<span class="dv">1</span>, <span class="dv">0</span>), <span class="st">'E'</span>): <span class="op">-</span><span class="fl">3.0</span>,</span>
<span id="cb4-19"><a href="#cb4-19"></a> ((<span class="dv">1</span>, <span class="dv">0</span>), <span class="st">'N'</span>): <span class="op">-</span><span class="fl">1.0</span>,</span>
<span id="cb4-20"><a href="#cb4-20"></a> ((<span class="dv">1</span>, <span class="dv">0</span>), <span class="st">'S'</span>): <span class="op">-</span><span class="fl">3.0</span>,</span>
<span id="cb4-21"><a href="#cb4-21"></a> ((<span class="dv">1</span>, <span class="dv">1</span>), <span class="st">'W'</span>): <span class="op">-</span><span class="fl">2.0</span>,</span>
<span id="cb4-22"><a href="#cb4-22"></a> ((<span class="dv">1</span>, <span class="dv">1</span>), <span class="st">'E'</span>): <span class="op">-</span><span class="fl">4.0</span>,</span>
<span id="cb4-23"><a href="#cb4-23"></a> ((<span class="dv">1</span>, <span class="dv">1</span>), <span class="st">'N'</span>): <span class="op">-</span><span class="fl">2.0</span>,</span>
<span id="cb4-24"><a href="#cb4-24"></a> ((<span class="dv">1</span>, <span class="dv">1</span>), <span class="st">'S'</span>): <span class="op">-</span><span class="fl">4.0</span>,</span>
<span id="cb4-25"><a href="#cb4-25"></a> ((<span class="dv">1</span>, <span class="dv">2</span>), <span class="st">'W'</span>): <span class="op">-</span><span class="fl">3.0</span>,</span>
<span id="cb4-26"><a href="#cb4-26"></a> ((<span class="dv">1</span>, <span class="dv">2</span>), <span class="st">'E'</span>): <span class="op">-</span><span class="fl">3.0</span>,</span>
<span id="cb4-27"><a href="#cb4-27"></a> ((<span class="dv">1</span>, <span class="dv">2</span>), <span class="st">'N'</span>): <span class="op">-</span><span class="fl">3.0</span>,</span>
<span id="cb4-28"><a href="#cb4-28"></a> ((<span class="dv">1</span>, <span class="dv">2</span>), <span class="st">'S'</span>): <span class="op">-</span><span class="fl">3.0</span>,</span>
<span id="cb4-29"><a href="#cb4-29"></a> ((<span class="dv">1</span>, <span class="dv">3</span>), <span class="st">'W'</span>): <span class="op">-</span><span class="fl">4.0</span>,</span>
<span id="cb4-30"><a href="#cb4-30"></a> ((<span class="dv">1</span>, <span class="dv">3</span>), <span class="st">'E'</span>): <span class="op">-</span><span class="fl">3.0</span>,</span>
<span id="cb4-31"><a href="#cb4-31"></a> ((<span class="dv">1</span>, <span class="dv">3</span>), <span class="st">'N'</span>): <span class="op">-</span><span class="fl">4.0</span>,</span>
<span id="cb4-32"><a href="#cb4-32"></a> ((<span class="dv">1</span>, <span class="dv">3</span>), <span class="st">'S'</span>): <span class="op">-</span><span class="fl">2.0</span>,</span>
<span id="cb4-33"><a href="#cb4-33"></a> ((<span class="dv">2</span>, <span class="dv">0</span>), <span class="st">'W'</span>): <span class="op">-</span><span class="fl">3.0</span>,</span>
<span id="cb4-34"><a href="#cb4-34"></a> ((<span class="dv">2</span>, <span class="dv">0</span>), <span class="st">'E'</span>): <span class="op">-</span><span class="fl">4.0</span>,</span>
<span id="cb4-35"><a href="#cb4-35"></a> ((<span class="dv">2</span>, <span class="dv">0</span>), <span class="st">'N'</span>): <span class="op">-</span><span class="fl">2.0</span>,</span>
<span id="cb4-36"><a href="#cb4-36"></a> ((<span class="dv">2</span>, <span class="dv">0</span>), <span class="st">'S'</span>): <span class="op">-</span><span class="fl">4.0</span>,</span>
<span id="cb4-37"><a href="#cb4-37"></a> ((<span class="dv">2</span>, <span class="dv">1</span>), <span class="st">'W'</span>): <span class="op">-</span><span class="fl">3.0</span>,</span>
<span id="cb4-38"><a href="#cb4-38"></a> ((<span class="dv">2</span>, <span class="dv">1</span>), <span class="st">'E'</span>): <span class="op">-</span><span class="fl">3.0</span>,</span>
<span id="cb4-39"><a href="#cb4-39"></a> ((<span class="dv">2</span>, <span class="dv">1</span>), <span class="st">'N'</span>): <span class="op">-</span><span class="fl">3.0</span>,</span>
<span id="cb4-40"><a href="#cb4-40"></a> ((<span class="dv">2</span>, <span class="dv">1</span>), <span class="st">'S'</span>): <span class="op">-</span><span class="fl">3.0</span>,</span>
<span id="cb4-41"><a href="#cb4-41"></a> ((<span class="dv">2</span>, <span class="dv">2</span>), <span class="st">'W'</span>): <span class="op">-</span><span class="fl">4.0</span>,</span>
<span id="cb4-42"><a href="#cb4-42"></a> ((<span class="dv">2</span>, <span class="dv">2</span>), <span class="st">'E'</span>): <span class="op">-</span><span class="fl">2.0</span>,</span>
<span id="cb4-43"><a href="#cb4-43"></a> ((<span class="dv">2</span>, <span class="dv">2</span>), <span class="st">'N'</span>): <span class="op">-</span><span class="fl">4.0</span>,</span>
<span id="cb4-44"><a href="#cb4-44"></a> ((<span class="dv">2</span>, <span class="dv">2</span>), <span class="st">'S'</span>): <span class="op">-</span><span class="fl">2.0</span>,</span>
<span id="cb4-45"><a href="#cb4-45"></a> ((<span class="dv">2</span>, <span class="dv">3</span>), <span class="st">'W'</span>): <span class="op">-</span><span class="fl">3.0</span>,</span>
<span id="cb4-46"><a href="#cb4-46"></a> ((<span class="dv">2</span>, <span class="dv">3</span>), <span class="st">'E'</span>): <span class="op">-</span><span class="fl">2.0</span>,</span>
<span id="cb4-47"><a href="#cb4-47"></a> ((<span class="dv">2</span>, <span class="dv">3</span>), <span class="st">'N'</span>): <span class="op">-</span><span class="fl">3.0</span>,</span>
<span id="cb4-48"><a href="#cb4-48"></a> ((<span class="dv">2</span>, <span class="dv">3</span>), <span class="st">'S'</span>): <span class="op">-</span><span class="fl">1.0</span>,</span>
<span id="cb4-49"><a href="#cb4-49"></a> ((<span class="dv">3</span>, <span class="dv">0</span>), <span class="st">'W'</span>): <span class="op">-</span><span class="fl">4.0</span>,</span>
<span id="cb4-50"><a href="#cb4-50"></a> ((<span class="dv">3</span>, <span class="dv">0</span>), <span class="st">'E'</span>): <span class="op">-</span><span class="fl">3.0</span>,</span>
<span id="cb4-51"><a href="#cb4-51"></a> ((<span class="dv">3</span>, <span class="dv">0</span>), <span class="st">'N'</span>): <span class="op">-</span><span class="fl">3.0</span>,</span>
<span id="cb4-52"><a href="#cb4-52"></a> ((<span class="dv">3</span>, <span class="dv">0</span>), <span class="st">'S'</span>): <span class="op">-</span><span class="fl">4.0</span>,</span>
<span id="cb4-53"><a href="#cb4-53"></a> ((<span class="dv">3</span>, <span class="dv">1</span>), <span class="st">'W'</span>): <span class="op">-</span><span class="fl">4.0</span>,</span>
<span id="cb4-54"><a href="#cb4-54"></a> ((<span class="dv">3</span>, <span class="dv">1</span>), <span class="st">'E'</span>): <span class="op">-</span><span class="fl">2.0</span>,</span>
<span id="cb4-55"><a href="#cb4-55"></a> ((<span class="dv">3</span>, <span class="dv">1</span>), <span class="st">'N'</span>): <span class="op">-</span><span class="fl">4.0</span>,</span>
<span id="cb4-56"><a href="#cb4-56"></a> ((<span class="dv">3</span>, <span class="dv">1</span>), <span class="st">'S'</span>): <span class="op">-</span><span class="fl">3.0</span>,</span>
<span id="cb4-57"><a href="#cb4-57"></a> ((<span class="dv">3</span>, <span class="dv">2</span>), <span class="st">'W'</span>): <span class="op">-</span><span class="fl">3.0</span>,</span>
<span id="cb4-58"><a href="#cb4-58"></a> ((<span class="dv">3</span>, <span class="dv">2</span>), <span class="st">'E'</span>): <span class="op">-</span><span class="fl">1.0</span>,</span>
<span id="cb4-59"><a href="#cb4-59"></a> ((<span class="dv">3</span>, <span class="dv">2</span>), <span class="st">'N'</span>): <span class="op">-</span><span class="fl">3.0</span>,</span>
<span id="cb4-60"><a href="#cb4-60"></a> ((<span class="dv">3</span>, <span class="dv">2</span>), <span class="st">'S'</span>): <span class="op">-</span><span class="fl">2.0</span>,</span>
<span id="cb4-61"><a href="#cb4-61"></a> ((<span class="dv">3</span>, <span class="dv">3</span>), <span class="st">'W'</span>): <span class="dv">0</span>,</span>
<span id="cb4-62"><a href="#cb4-62"></a> ((<span class="dv">3</span>, <span class="dv">3</span>), <span class="st">'E'</span>): <span class="dv">0</span>,</span>
<span id="cb4-63"><a href="#cb4-63"></a> ((<span class="dv">3</span>, <span class="dv">3</span>), <span class="st">'N'</span>): <span class="dv">0</span>,</span>
<span id="cb4-64"><a href="#cb4-64"></a> ((<span class="dv">3</span>, <span class="dv">3</span>), <span class="st">'S'</span>): <span class="dv">0</span>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="set-up" class="level1">
<h1>Set up</h1>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1"></a><span class="kw">class</span> Environment():</span>
<span id="cb5-2"><a href="#cb5-2"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>,grid_size):</span>
<span id="cb5-3"><a href="#cb5-3"></a>        <span class="va">self</span>.grid_size <span class="op">=</span> np.array(grid_size)</span>
<span id="cb5-4"><a href="#cb5-4"></a>        <span class="va">self</span>.S <span class="op">=</span> [np.array([i,j]) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(grid_size[<span class="dv">0</span>]) <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(grid_size[<span class="dv">1</span>])]</span>
<span id="cb5-5"><a href="#cb5-5"></a>        <span class="va">self</span>.Terminal_states <span class="op">=</span> [(<span class="dv">0</span>,<span class="dv">0</span>),(<span class="va">self</span>.grid_size[<span class="dv">0</span>]<span class="op">-</span><span class="dv">1</span>,<span class="va">self</span>.grid_size[<span class="dv">1</span>]<span class="op">-</span><span class="dv">1</span>)]</span>
<span id="cb5-6"><a href="#cb5-6"></a>        <span class="va">self</span>.A <span class="op">=</span> [<span class="st">"W"</span>,<span class="st">"E"</span>,<span class="st">"N"</span>,<span class="st">"S"</span>]</span>
<span id="cb5-7"><a href="#cb5-7"></a>        <span class="va">self</span>.A_to_coord <span class="op">=</span> {<span class="st">"W"</span> : [<span class="dv">0</span>,<span class="op">-</span><span class="dv">1</span>],<span class="st">"E"</span> : [<span class="dv">0</span>,<span class="dv">1</span>], <span class="st">"N"</span> : [<span class="op">-</span><span class="dv">1</span>,<span class="dv">0</span>], <span class="st">"S"</span> : [<span class="dv">1</span>,<span class="dv">0</span>]}</span>
<span id="cb5-8"><a href="#cb5-8"></a>        <span class="cf">for</span> k,v <span class="kw">in</span> <span class="va">self</span>.A_to_coord.items():</span>
<span id="cb5-9"><a href="#cb5-9"></a>            <span class="va">self</span>.A_to_coord[k] <span class="op">=</span> np.array(v)</span>
<span id="cb5-10"><a href="#cb5-10"></a>        <span class="va">self</span>.gamma <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb5-11"><a href="#cb5-11"></a>        <span class="va">self</span>.R <span class="op">=</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb5-12"><a href="#cb5-12"></a>    </span>
<span id="cb5-13"><a href="#cb5-13"></a>    <span class="kw">def</span> move(<span class="va">self</span>,s,a):</span>
<span id="cb5-14"><a href="#cb5-14"></a>        <span class="co">"""</span></span>
<span id="cb5-15"><a href="#cb5-15"></a><span class="co">        Input</span></span>
<span id="cb5-16"><a href="#cb5-16"></a><span class="co">        s : current_state(position)</span></span>
<span id="cb5-17"><a href="#cb5-17"></a><span class="co">        a : action(from deterministic policy π)</span></span>
<span id="cb5-18"><a href="#cb5-18"></a><span class="co">        output</span></span>
<span id="cb5-19"><a href="#cb5-19"></a><span class="co">        s_next : state after one_step transition</span></span>
<span id="cb5-20"><a href="#cb5-20"></a><span class="co">        ex)</span></span>
<span id="cb5-21"><a href="#cb5-21"></a><span class="co">        Input : s = [0,1],a = "W"</span></span>
<span id="cb5-22"><a href="#cb5-22"></a><span class="co">        Output : s_next = [0,0]</span></span>
<span id="cb5-23"><a href="#cb5-23"></a><span class="co">        """</span></span>
<span id="cb5-24"><a href="#cb5-24"></a>        s_next <span class="op">=</span> s <span class="op">+</span> <span class="va">self</span>.A_to_coord[a]</span>
<span id="cb5-25"><a href="#cb5-25"></a>        <span class="cf">if</span> s_next[<span class="dv">0</span>] <span class="op">&lt;</span> <span class="dv">0</span> <span class="kw">or</span> s_next[<span class="dv">1</span>] <span class="op">&lt;</span><span class="dv">0</span> <span class="kw">or</span> s_next[<span class="dv">0</span>] <span class="op">&gt;=</span> <span class="va">self</span>.grid_size[<span class="dv">0</span>] <span class="kw">or</span> s_next[<span class="dv">1</span>] <span class="op">&gt;=</span> <span class="va">self</span>.grid_size[<span class="dv">1</span>]:</span>
<span id="cb5-26"><a href="#cb5-26"></a>            <span class="cf">return</span> s <span class="co"># |S|를 넘어갈 경우, 원래 상태를 반환</span></span>
<span id="cb5-27"><a href="#cb5-27"></a>        <span class="cf">else</span>:</span>
<span id="cb5-28"><a href="#cb5-28"></a>            <span class="cf">return</span> s_next</span>
<span id="cb5-29"><a href="#cb5-29"></a>        </span>
<span id="cb5-30"><a href="#cb5-30"></a>    <span class="kw">def</span> move_test(<span class="va">self</span>):</span>
<span id="cb5-31"><a href="#cb5-31"></a>        S <span class="op">=</span> [np.array([i,j]) <span class="cf">for</span> i <span class="kw">in</span> [<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>] <span class="cf">for</span> j <span class="kw">in</span> [<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>]]</span>
<span id="cb5-32"><a href="#cb5-32"></a>        <span class="cf">for</span> s <span class="kw">in</span> S:</span>
<span id="cb5-33"><a href="#cb5-33"></a>            <span class="cf">for</span> a <span class="kw">in</span> <span class="va">self</span>.A:</span>
<span id="cb5-34"><a href="#cb5-34"></a>                <span class="bu">print</span>(s,a,<span class="va">self</span>.move(s,a))</span>
<span id="cb5-35"><a href="#cb5-35"></a>    <span class="kw">def</span> dynamics(<span class="va">self</span>,s_prime,r,s,a):</span>
<span id="cb5-36"><a href="#cb5-36"></a>        r<span class="op">=-</span><span class="dv">1</span></span>
<span id="cb5-37"><a href="#cb5-37"></a>        <span class="co">"""</span></span>
<span id="cb5-38"><a href="#cb5-38"></a><span class="co">        Input</span></span>
<span id="cb5-39"><a href="#cb5-39"></a><span class="co">        s : current_state(position)</span></span>
<span id="cb5-40"><a href="#cb5-40"></a><span class="co">        a : action(from deterministic policy π)</span></span>
<span id="cb5-41"><a href="#cb5-41"></a><span class="co">        s_prime : all of the possible states after one-step transition</span></span>
<span id="cb5-42"><a href="#cb5-42"></a><span class="co">        r : immediate reward(-1)</span></span>
<span id="cb5-43"><a href="#cb5-43"></a><span class="co">        output</span></span>
<span id="cb5-44"><a href="#cb5-44"></a><span class="co">        0 if s에서 a로 움직였을때의 변화된 상태 next_s와 s_prime의 input이 다를때</span></span>
<span id="cb5-45"><a href="#cb5-45"></a><span class="co">        1 if s에서 a로 움직였을때의 변화된 상태 next_s와 s_prime의 input이 같을때</span></span>
<span id="cb5-46"><a href="#cb5-46"></a><span class="co">        즉, a방향으로 움직이면 반드시 a방향으로 감(deterministic)</span></span>
<span id="cb5-47"><a href="#cb5-47"></a><span class="co">        """</span></span>
<span id="cb5-48"><a href="#cb5-48"></a>        s_next <span class="op">=</span> <span class="va">self</span>.move(s,a)</span>
<span id="cb5-49"><a href="#cb5-49"></a>        <span class="cf">if</span> np.<span class="bu">sum</span>(s_next <span class="op">!=</span> s_prime)<span class="op">&gt;=</span><span class="dv">1</span>:</span>
<span id="cb5-50"><a href="#cb5-50"></a>            <span class="cf">return</span> <span class="dv">0</span></span>
<span id="cb5-51"><a href="#cb5-51"></a>        <span class="cf">else</span>:</span>
<span id="cb5-52"><a href="#cb5-52"></a>            <span class="cf">return</span> <span class="dv">1</span></span>
<span id="cb5-53"><a href="#cb5-53"></a>    <span class="kw">def</span> dynamics_test(<span class="va">self</span>,check_p <span class="op">=</span> <span class="dv">1</span>):</span>
<span id="cb5-54"><a href="#cb5-54"></a>        r<span class="op">=-</span><span class="dv">1</span></span>
<span id="cb5-55"><a href="#cb5-55"></a>        <span class="cf">for</span> s <span class="kw">in</span> <span class="va">self</span>.S:</span>
<span id="cb5-56"><a href="#cb5-56"></a>            <span class="cf">for</span> a <span class="kw">in</span> <span class="va">self</span>.A:</span>
<span id="cb5-57"><a href="#cb5-57"></a>                <span class="cf">for</span> s_prime <span class="kw">in</span> <span class="va">self</span>.S: <span class="co">#가능한 모든 next_state</span></span>
<span id="cb5-58"><a href="#cb5-58"></a>                    <span class="cf">if</span> <span class="va">self</span>.dynamics(s_prime,r,s,a) <span class="op">==</span> check_p:</span>
<span id="cb5-59"><a href="#cb5-59"></a>                        <span class="bu">print</span>(<span class="ss">f"state : </span><span class="sc">{</span>s<span class="sc">}</span><span class="ss"> action : </span><span class="sc">{</span>a<span class="sc">}</span><span class="ss"> s_prime : </span><span class="sc">{</span>s_prime<span class="sc">}</span><span class="ss"> dynamics : </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>dynamics(s_prime,r,s,a)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb5-60"><a href="#cb5-60"></a>    <span class="kw">def</span> sampling_action(<span class="va">self</span>,s_t,π):</span>
<span id="cb5-61"><a href="#cb5-61"></a>        <span class="co">"""</span></span>
<span id="cb5-62"><a href="#cb5-62"></a><span class="co">        Input current state s_t : tuple</span></span>
<span id="cb5-63"><a href="#cb5-63"></a><span class="co">        ouput action : str (a ~ π(a|s))</span></span>
<span id="cb5-64"><a href="#cb5-64"></a><span class="co">        """</span></span>
<span id="cb5-65"><a href="#cb5-65"></a>        actions <span class="op">=</span> []</span>
<span id="cb5-66"><a href="#cb5-66"></a>        prob <span class="op">=</span> []</span>
<span id="cb5-67"><a href="#cb5-67"></a>        <span class="cf">for</span> a,p <span class="kw">in</span> π[s_t].items():</span>
<span id="cb5-68"><a href="#cb5-68"></a>            actions.append(a)</span>
<span id="cb5-69"><a href="#cb5-69"></a>            prob.append(p)</span>
<span id="cb5-70"><a href="#cb5-70"></a>        <span class="co">#print(prob)</span></span>
<span id="cb5-71"><a href="#cb5-71"></a>        <span class="cf">return</span> np.random.choice(a<span class="op">=</span>actions,p<span class="op">=</span>prob)</span>
<span id="cb5-72"><a href="#cb5-72"></a>    <span class="kw">def</span> generate_π(<span class="va">self</span>,uniform<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb5-73"><a href="#cb5-73"></a>        <span class="co">"""</span></span>
<span id="cb5-74"><a href="#cb5-74"></a><span class="co">        Input : NA</span></span>
<span id="cb5-75"><a href="#cb5-75"></a><span class="co">        Output : {(x,y) : {"W" : pr1,"E" : pr2 ,...}}</span></span>
<span id="cb5-76"><a href="#cb5-76"></a><span class="co">        ex)</span></span>
<span id="cb5-77"><a href="#cb5-77"></a><span class="co">        {(0,0):{"W" : 0.1, "E" : 0.2, ...},(0,1):{"W":0.4,"E":0.5...}}</span></span>
<span id="cb5-78"><a href="#cb5-78"></a><span class="co">        """</span></span>
<span id="cb5-79"><a href="#cb5-79"></a>        π <span class="op">=</span> {(i,j): {} <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>.grid_size[<span class="dv">0</span>]) <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>.grid_size[<span class="dv">1</span>])}</span>
<span id="cb5-80"><a href="#cb5-80"></a>        <span class="cf">for</span> t <span class="kw">in</span> π.values():</span>
<span id="cb5-81"><a href="#cb5-81"></a>            unnormalized_prob <span class="op">=</span> np.random.rand(<span class="dv">4</span>)</span>
<span id="cb5-82"><a href="#cb5-82"></a>            <span class="cf">if</span> uniform <span class="op">==</span> <span class="va">False</span>:</span>
<span id="cb5-83"><a href="#cb5-83"></a>                prob <span class="op">=</span> unnormalized_prob<span class="op">/</span>np.<span class="bu">sum</span>(unnormalized_prob)</span>
<span id="cb5-84"><a href="#cb5-84"></a>            <span class="cf">else</span>:</span>
<span id="cb5-85"><a href="#cb5-85"></a>                prob <span class="op">=</span> [<span class="fl">0.25</span>] <span class="op">*</span> <span class="dv">4</span></span>
<span id="cb5-86"><a href="#cb5-86"></a>            <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(<span class="va">self</span>.A)):</span>
<span id="cb5-87"><a href="#cb5-87"></a>                t[<span class="va">self</span>.A[i]] <span class="op">=</span> prob[i]</span>
<span id="cb5-88"><a href="#cb5-88"></a>        <span class="cf">return</span> π</span>
<span id="cb5-89"><a href="#cb5-89"></a>    <span class="kw">def</span> argmax_a_Q(<span class="va">self</span>,Q,s):</span>
<span id="cb5-90"><a href="#cb5-90"></a>        max_action <span class="op">=</span> <span class="st">"W"</span></span>
<span id="cb5-91"><a href="#cb5-91"></a>        max_value <span class="op">=</span> <span class="op">-</span><span class="dv">5000</span></span>
<span id="cb5-92"><a href="#cb5-92"></a>        <span class="cf">for</span> visit,Q_val <span class="kw">in</span> Q.items():</span>
<span id="cb5-93"><a href="#cb5-93"></a>            <span class="cf">if</span> visit[<span class="dv">0</span>] <span class="op">==</span> s:</span>
<span id="cb5-94"><a href="#cb5-94"></a>                <span class="cf">if</span> Q_val <span class="op">&gt;</span> max_value:</span>
<span id="cb5-95"><a href="#cb5-95"></a>                    max_action <span class="op">=</span> visit[<span class="dv">1</span>]</span>
<span id="cb5-96"><a href="#cb5-96"></a>                    max_value <span class="op">=</span> Q_val                    </span>
<span id="cb5-97"><a href="#cb5-97"></a>        <span class="cf">return</span> max_action</span>
<span id="cb5-98"><a href="#cb5-98"></a><span class="kw">class</span> Q_learning(Environment):</span>
<span id="cb5-99"><a href="#cb5-99"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>,grid_size<span class="op">=</span>(<span class="dv">4</span>,<span class="dv">4</span>)):</span>
<span id="cb5-100"><a href="#cb5-100"></a>        <span class="bu">super</span>().<span class="fu">__init__</span>(grid_size)</span>
<span id="cb5-101"><a href="#cb5-101"></a>    </span>
<span id="cb5-102"><a href="#cb5-102"></a>    <span class="kw">def</span> control(<span class="va">self</span>,s_0,iter_num,alpha,epsilon):</span>
<span id="cb5-103"><a href="#cb5-103"></a>        Q <span class="op">=</span> {(<span class="bu">tuple</span>(s),a) : <span class="dv">0</span> <span class="cf">for</span> s <span class="kw">in</span> <span class="va">self</span>.S <span class="cf">for</span> a <span class="kw">in</span> <span class="va">self</span>.A}</span>
<span id="cb5-104"><a href="#cb5-104"></a>        π <span class="op">=</span> <span class="va">self</span>.generate_π()</span>
<span id="cb5-105"><a href="#cb5-105"></a>        γ <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb5-106"><a href="#cb5-106"></a>        <span class="cf">for</span> ep_num <span class="kw">in</span> <span class="bu">range</span>(iter_num):</span>
<span id="cb5-107"><a href="#cb5-107"></a>            ϵ <span class="op">=</span> epsilon <span class="op">**</span> (ep_num <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb5-108"><a href="#cb5-108"></a>            α <span class="op">=</span> alpha <span class="op">**</span> (ep_num <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb5-109"><a href="#cb5-109"></a>            <span class="cf">if</span> ep_num <span class="op">%</span> <span class="dv">1000</span> <span class="op">==</span> <span class="va">True</span>:</span>
<span id="cb5-110"><a href="#cb5-110"></a>                <span class="bu">print</span>(<span class="ss">f"epsilon : </span><span class="sc">{ϵ}</span><span class="ss"> alpha : </span><span class="sc">{α}</span><span class="ss">"</span>)</span>
<span id="cb5-111"><a href="#cb5-111"></a>            s_t <span class="op">=</span> s_0</span>
<span id="cb5-112"><a href="#cb5-112"></a>            <span class="cf">while</span> s_t <span class="kw">not</span> <span class="kw">in</span> <span class="va">self</span>.Terminal_states:</span>
<span id="cb5-113"><a href="#cb5-113"></a>                a_t <span class="op">=</span> <span class="va">self</span>.sampling_action(s_t,π)</span>
<span id="cb5-114"><a href="#cb5-114"></a>                r,s_prime <span class="op">=</span> <span class="op">-</span><span class="dv">1</span>,<span class="bu">tuple</span>(<span class="va">self</span>.move(s_t,a_t))</span>
<span id="cb5-115"><a href="#cb5-115"></a>                Q[(s_t,a_t)] <span class="op">=</span> Q[(s_t,a_t)] <span class="op">+</span> α <span class="op">*</span> (r <span class="op">+</span> γ <span class="op">*</span> Q[(s_prime,<span class="va">self</span>.argmax_a_Q(Q,s_prime))] <span class="op">-</span> Q[(s_t,a_t)])</span>
<span id="cb5-116"><a href="#cb5-116"></a>                </span>
<span id="cb5-117"><a href="#cb5-117"></a>                a_star <span class="op">=</span> <span class="va">self</span>.argmax_a_Q(Q,<span class="bu">tuple</span>(s_t))</span>
<span id="cb5-118"><a href="#cb5-118"></a>                <span class="cf">for</span> (state,action),value <span class="kw">in</span> Q.items():</span>
<span id="cb5-119"><a href="#cb5-119"></a>                    <span class="cf">if</span> action <span class="op">==</span> a_star:</span>
<span id="cb5-120"><a href="#cb5-120"></a>                        π[state][action] <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> ϵ <span class="op">+</span> ϵ <span class="op">/</span><span class="bu">len</span>(<span class="va">self</span>.A)</span>
<span id="cb5-121"><a href="#cb5-121"></a>                    <span class="cf">else</span>:</span>
<span id="cb5-122"><a href="#cb5-122"></a>                        π[state][action] <span class="op">=</span> ϵ<span class="op">/</span><span class="bu">len</span>(<span class="va">self</span>.A)</span>
<span id="cb5-123"><a href="#cb5-123"></a>                s_t <span class="op">=</span> s_prime</span>
<span id="cb5-124"><a href="#cb5-124"></a>        <span class="cf">return</span> π,Q</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="td_prediction" class="level1">
<h1>TD_Prediction</h1>
<section id="strategy1" class="level2">
<h2 class="anchored" data-anchor-id="strategy1">strategy1</h2>
<span class="math display">\[\begin{aligned}
\alpha(s) = \frac{1}{N(s)}
\end{aligned}\]</span>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1"></a><span class="kw">class</span> TD(Environment):</span>
<span id="cb6-2"><a href="#cb6-2"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>,grid_size<span class="op">=</span>(<span class="dv">4</span>,<span class="dv">4</span>)):</span>
<span id="cb6-3"><a href="#cb6-3"></a>        <span class="bu">super</span>().<span class="fu">__init__</span>(grid_size)</span>
<span id="cb6-4"><a href="#cb6-4"></a>    <span class="kw">def</span> prediction(<span class="va">self</span>,s_0,π,iter_nums <span class="op">=</span> <span class="dv">50</span>):</span>
<span id="cb6-5"><a href="#cb6-5"></a>        t <span class="op">=</span> time.time()</span>
<span id="cb6-6"><a href="#cb6-6"></a>        V <span class="op">=</span> {<span class="bu">tuple</span>(s) : <span class="dv">0</span> <span class="cf">for</span> s <span class="kw">in</span> <span class="va">self</span>.S}</span>
<span id="cb6-7"><a href="#cb6-7"></a>        N <span class="op">=</span> {<span class="bu">tuple</span>(s) : <span class="dv">0</span> <span class="cf">for</span> s <span class="kw">in</span> <span class="va">self</span>.S}</span>
<span id="cb6-8"><a href="#cb6-8"></a>        <span class="cf">for</span> ep_num <span class="kw">in</span> <span class="bu">range</span>(iter_nums):</span>
<span id="cb6-9"><a href="#cb6-9"></a>            N[s_0] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb6-10"><a href="#cb6-10"></a>            s_t <span class="op">=</span> s_0</span>
<span id="cb6-11"><a href="#cb6-11"></a>            <span class="cf">while</span> s_t <span class="kw">not</span> <span class="kw">in</span> <span class="va">self</span>.Terminal_states:</span>
<span id="cb6-12"><a href="#cb6-12"></a>                a_t <span class="op">=</span> <span class="va">self</span>.sampling_action(s_t,π)</span>
<span id="cb6-13"><a href="#cb6-13"></a>                r,s_prime <span class="op">=</span> <span class="op">-</span><span class="dv">1</span>,<span class="bu">tuple</span>(<span class="va">self</span>.move(s_t,a_t))</span>
<span id="cb6-14"><a href="#cb6-14"></a>                N[s_prime] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb6-15"><a href="#cb6-15"></a>                V[s_t] <span class="op">=</span> V[s_t] <span class="op">+</span> (<span class="dv">1</span><span class="op">/</span>N[s_t]) <span class="op">*</span> (r <span class="op">+</span> <span class="dv">1</span><span class="op">*</span>V[s_prime] <span class="op">-</span> V[s_t])</span>
<span id="cb6-16"><a href="#cb6-16"></a>                s_t <span class="op">=</span> s_prime</span>
<span id="cb6-17"><a href="#cb6-17"></a>        <span class="bu">print</span>(<span class="ss">f"lead time : </span><span class="sc">{</span>time<span class="sc">.</span>time()<span class="op">-</span>t<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb6-18"><a href="#cb6-18"></a>        <span class="cf">return</span> N,V</span>
<span id="cb6-19"><a href="#cb6-19"></a></span>
<span id="cb6-20"><a href="#cb6-20"></a>td <span class="op">=</span> TD()</span>
<span id="cb6-21"><a href="#cb6-21"></a>π <span class="op">=</span> td.generate_π(<span class="va">True</span>)</span>
<span id="cb6-22"><a href="#cb6-22"></a>N,V <span class="op">=</span> td.prediction(s_0 <span class="op">=</span> (<span class="dv">2</span>,<span class="dv">1</span>),π <span class="op">=</span> π,iter_nums <span class="op">=</span> <span class="dv">10000</span>)</span>
<span id="cb6-23"><a href="#cb6-23"></a>N,V</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>lead time : 3.84700870513916</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre><code>({(0, 0): 4991,
  (0, 1): 8714,
  (0, 2): 11013,
  (0, 3): 10582,
  (1, 0): 11445,
  (1, 1): 15471,
  (1, 2): 12949,
  (1, 3): 10557,
  (2, 0): 19396,
  (2, 1): 27376,
  (2, 2): 14850,
  (2, 3): 8354,
  (3, 0): 19121,
  (3, 1): 19306,
  (3, 2): 11468,
  (3, 3): 5009},
 {(0, 0): 0,
  (0, 1): -6.210219153348596,
  (0, 2): -8.383241068493124,
  (0, 3): -9.002126728634252,
  (1, 0): -6.1390042000236225,
  (1, 1): -7.7515192854294215,
  (1, 2): -8.454972138492304,
  (1, 3): -8.392769233108076,
  (2, 0): -8.330045542123194,
  (2, 1): -8.421539073360337,
  (2, 2): -7.734287084877186,
  (2, 3): -6.146458879225036,
  (3, 0): -8.911924754087085,
  (3, 1): -8.321791681471996,
  (3, 2): -6.097562056472681,
  (3, 3): 0})</code></pre>
</div>
</div>
<ul>
<li>It doesn’t converge to a true value.</li>
<li>I thought the number of iterations was too small, so I did some more.</li>
</ul>
<div class="cell" data-execution_count="135">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1"></a><span class="kw">class</span> TD(Environment):</span>
<span id="cb9-2"><a href="#cb9-2"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>,grid_size<span class="op">=</span>(<span class="dv">4</span>,<span class="dv">4</span>)):</span>
<span id="cb9-3"><a href="#cb9-3"></a>        <span class="bu">super</span>().<span class="fu">__init__</span>(grid_size)</span>
<span id="cb9-4"><a href="#cb9-4"></a>    <span class="kw">def</span> prediction(<span class="va">self</span>,s_0,π,iter_nums <span class="op">=</span> <span class="dv">50</span>):</span>
<span id="cb9-5"><a href="#cb9-5"></a>        t <span class="op">=</span> time.time()</span>
<span id="cb9-6"><a href="#cb9-6"></a>        V <span class="op">=</span> {<span class="bu">tuple</span>(s) : <span class="dv">0</span> <span class="cf">for</span> s <span class="kw">in</span> <span class="va">self</span>.S}</span>
<span id="cb9-7"><a href="#cb9-7"></a>        N <span class="op">=</span> {<span class="bu">tuple</span>(s) : <span class="dv">0</span> <span class="cf">for</span> s <span class="kw">in</span> <span class="va">self</span>.S}</span>
<span id="cb9-8"><a href="#cb9-8"></a>        <span class="cf">for</span> ep_num <span class="kw">in</span> <span class="bu">range</span>(iter_nums):</span>
<span id="cb9-9"><a href="#cb9-9"></a>            N[s_0] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb9-10"><a href="#cb9-10"></a>            s_t <span class="op">=</span> s_0</span>
<span id="cb9-11"><a href="#cb9-11"></a>            <span class="cf">while</span> s_t <span class="kw">not</span> <span class="kw">in</span> <span class="va">self</span>.Terminal_states:</span>
<span id="cb9-12"><a href="#cb9-12"></a>                a_t <span class="op">=</span> <span class="va">self</span>.sampling_action(s_t,π)</span>
<span id="cb9-13"><a href="#cb9-13"></a>                r,s_prime <span class="op">=</span> <span class="op">-</span><span class="dv">1</span>,<span class="bu">tuple</span>(<span class="va">self</span>.move(s_t,a_t))</span>
<span id="cb9-14"><a href="#cb9-14"></a>                N[s_prime] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb9-15"><a href="#cb9-15"></a>                V[s_t] <span class="op">=</span> V[s_t] <span class="op">+</span> (<span class="dv">1</span><span class="op">/</span>N[s_t]) <span class="op">*</span> (r <span class="op">+</span> <span class="dv">1</span><span class="op">*</span>V[s_prime] <span class="op">-</span> V[s_t])</span>
<span id="cb9-16"><a href="#cb9-16"></a>                s_t <span class="op">=</span> s_prime</span>
<span id="cb9-17"><a href="#cb9-17"></a>        <span class="bu">print</span>(<span class="ss">f"lead time : </span><span class="sc">{</span>time<span class="sc">.</span>time()<span class="op">-</span>t<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb9-18"><a href="#cb9-18"></a>        <span class="cf">return</span> N,V</span>
<span id="cb9-19"><a href="#cb9-19"></a></span>
<span id="cb9-20"><a href="#cb9-20"></a>td <span class="op">=</span> TD()</span>
<span id="cb9-21"><a href="#cb9-21"></a>π <span class="op">=</span> td.generate_π(<span class="va">True</span>)</span>
<span id="cb9-22"><a href="#cb9-22"></a>N,V <span class="op">=</span> td.prediction(s_0 <span class="op">=</span> (<span class="dv">2</span>,<span class="dv">1</span>),π <span class="op">=</span> π,iter_nums <span class="op">=</span> <span class="dv">1000000</span>)</span>
<span id="cb9-23"><a href="#cb9-23"></a>N,V</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>lead time : 376.06808495521545</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="135">
<pre><code>({(0, 0): 500675,
  (0, 1): 857102,
  (0, 2): 1071635,
  (0, 3): 1068941,
  (1, 0): 1141288,
  (1, 1): 1497208,
  (1, 2): 1284379,
  (1, 3): 1069050,
  (2, 0): 1930091,
  (2, 1): 2714779,
  (2, 2): 1498691,
  (2, 3): 854888,
  (3, 0): 1928620,
  (3, 1): 1929364,
  (3, 2): 1141312,
  (3, 3): 499325},
 {(0, 0): 0,
  (0, 1): -7.710187158147642,
  (0, 2): -10.649747597920722,
  (0, 3): -11.512033496895874,
  (1, 0): -7.772392586046007,
  (1, 1): -9.839184282402476,
  (1, 2): -10.751129025128156,
  (1, 3): -10.654188503693032,
  (2, 0): -10.819929137588238,
  (2, 1): -10.85383247342236,
  (2, 2): -9.84822261146621,
  (2, 3): -7.712727075121741,
  (3, 0): -11.760013045162655,
  (3, 1): -10.832300462530744,
  (3, 2): -7.79454500536325,
  (3, 3): 0})</code></pre>
</div>
</div>
<ul>
<li>Increasing the iteration actually increased the difference with the true value function.</li>
<li>It seems wrong to modify <span class="math inline">\(\alpha\)</span> based on the number of returns like MC does.</li>
</ul>
</section>
<section id="strategy2" class="level2">
<h2 class="anchored" data-anchor-id="strategy2">strategy2</h2>
<span class="math display">\[\begin{aligned}
\alpha = k
\end{aligned}\]</span>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1"></a><span class="kw">class</span> TD(Environment):</span>
<span id="cb12-2"><a href="#cb12-2"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>,grid_size<span class="op">=</span>(<span class="dv">4</span>,<span class="dv">4</span>)):</span>
<span id="cb12-3"><a href="#cb12-3"></a>        <span class="bu">super</span>().<span class="fu">__init__</span>(grid_size)</span>
<span id="cb12-4"><a href="#cb12-4"></a>    <span class="kw">def</span> prediction(<span class="va">self</span>,s_0,π,iter_nums,α<span class="op">=</span><span class="fl">0.1</span>):</span>
<span id="cb12-5"><a href="#cb12-5"></a>        V <span class="op">=</span> {<span class="bu">tuple</span>(s) : <span class="dv">0</span> <span class="cf">for</span> s <span class="kw">in</span> <span class="va">self</span>.S}</span>
<span id="cb12-6"><a href="#cb12-6"></a>        <span class="cf">for</span> ep_num <span class="kw">in</span> <span class="bu">range</span>(iter_nums):</span>
<span id="cb12-7"><a href="#cb12-7"></a>            s_t <span class="op">=</span> s_0</span>
<span id="cb12-8"><a href="#cb12-8"></a>            <span class="cf">while</span> s_t <span class="kw">not</span> <span class="kw">in</span> <span class="va">self</span>.Terminal_states:</span>
<span id="cb12-9"><a href="#cb12-9"></a>                a_t <span class="op">=</span> <span class="va">self</span>.sampling_action(s_t,π)</span>
<span id="cb12-10"><a href="#cb12-10"></a>                r,s_prime <span class="op">=</span> <span class="op">-</span><span class="dv">1</span>,<span class="bu">tuple</span>(<span class="va">self</span>.move(s_t,a_t))</span>
<span id="cb12-11"><a href="#cb12-11"></a>                V[s_t] <span class="op">=</span> V[s_t] <span class="op">+</span> α <span class="op">*</span> (r <span class="op">+</span> <span class="dv">1</span><span class="op">*</span>V[s_prime] <span class="op">-</span> V[s_t])</span>
<span id="cb12-12"><a href="#cb12-12"></a>                s_t <span class="op">=</span> s_prime</span>
<span id="cb12-13"><a href="#cb12-13"></a>        <span class="cf">return</span> V</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1"></a>td <span class="op">=</span> TD()</span>
<span id="cb13-2"><a href="#cb13-2"></a>π <span class="op">=</span> td.generate_π(<span class="va">True</span>)</span>
<span id="cb13-3"><a href="#cb13-3"></a>V <span class="op">=</span> td.prediction(s_0 <span class="op">=</span> (<span class="dv">2</span>,<span class="dv">1</span>),π <span class="op">=</span> π,iter_nums <span class="op">=</span> <span class="dv">10000</span>,α <span class="op">=</span> <span class="fl">0.9</span>)</span>
<span id="cb13-4"><a href="#cb13-4"></a>V</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<pre><code>{(0, 0): 0,
 (0, 1): -3.0256925965875716,
 (0, 2): -5.332214113492295,
 (0, 3): -15.617543977702914,
 (1, 0): -3.0629017222896167,
 (1, 1): -23.2984430617318,
 (1, 2): -18.28574411528579,
 (1, 3): -19.756820878783724,
 (2, 0): -22.470596366545834,
 (2, 1): -18.796632804070903,
 (2, 2): -19.36917079379382,
 (2, 3): -16.783646559420106,
 (3, 0): -8.414317785731221,
 (3, 1): -8.23094812772801,
 (3, 2): -1.7208495942458732,
 (3, 3): 0}</code></pre>
</div>
</div>
<ul>
<li>It was still far from the true value, so I decided to reduce the alpha.</li>
</ul>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1"></a>td <span class="op">=</span> TD()</span>
<span id="cb15-2"><a href="#cb15-2"></a>π <span class="op">=</span> td.generate_π(<span class="va">True</span>)</span>
<span id="cb15-3"><a href="#cb15-3"></a>V <span class="op">=</span> td.prediction(s_0 <span class="op">=</span> (<span class="dv">2</span>,<span class="dv">1</span>),π <span class="op">=</span> π,iter_nums <span class="op">=</span> <span class="dv">10000</span>,α <span class="op">=</span> <span class="fl">0.25</span>)</span>
<span id="cb15-4"><a href="#cb15-4"></a>V</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre><code>{(0, 0): 0,
 (0, 1): -8.39849373243713,
 (0, 2): -21.498903370973046,
 (0, 3): -23.920539288117975,
 (1, 0): -18.9460598907016,
 (1, 1): -17.750880979198747,
 (1, 2): -20.324083266925584,
 (1, 3): -18.930470481543285,
 (2, 0): -21.57693034519246,
 (2, 1): -22.12603238307893,
 (2, 2): -20.463756775083247,
 (2, 3): -11.004329018730525,
 (3, 0): -23.981268316159696,
 (3, 1): -21.34414457966366,
 (3, 2): -10.81270597397484,
 (3, 3): 0}</code></pre>
</div>
</div>
<ul>
<li>It seemed to get a little closer to the true value at alpha=0.25.</li>
<li>So I wonder if it would converge if I increased the number of iterations here.</li>
</ul>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1"></a>td <span class="op">=</span> TD()</span>
<span id="cb17-2"><a href="#cb17-2"></a>π <span class="op">=</span> td.generate_π(<span class="va">True</span>)</span>
<span id="cb17-3"><a href="#cb17-3"></a>V <span class="op">=</span> td.prediction(s_0 <span class="op">=</span> (<span class="dv">2</span>,<span class="dv">1</span>),π <span class="op">=</span> π,iter_nums <span class="op">=</span> <span class="dv">100000</span>,α <span class="op">=</span> <span class="fl">0.25</span>)</span>
<span id="cb17-4"><a href="#cb17-4"></a>V</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<pre><code>{(0, 0): 0,
 (0, 1): -10.892909639267481,
 (0, 2): -16.389984823596123,
 (0, 3): -20.578998512300483,
 (1, 0): -10.115580086229546,
 (1, 1): -16.7374227182455,
 (1, 2): -19.376736534483427,
 (1, 3): -17.403295865603702,
 (2, 0): -17.706264918772543,
 (2, 1): -18.118900013790565,
 (2, 2): -19.26210200598588,
 (2, 3): -6.951457310762545,
 (3, 0): -20.307685831910902,
 (3, 1): -21.122118838034453,
 (3, 2): -15.332188651767787,
 (3, 3): 0}</code></pre>
</div>
</div>
<ul>
<li>It seemed to get a little more closer to the true value by increasing the number of iterations.</li>
<li>The intuition here is that by decreasing alpha more and more and increasing iterations, I can get closer to the true value.</li>
</ul>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1"></a>td <span class="op">=</span> TD()</span>
<span id="cb19-2"><a href="#cb19-2"></a>π <span class="op">=</span> td.generate_π(<span class="va">True</span>)</span>
<span id="cb19-3"><a href="#cb19-3"></a>V <span class="op">=</span> td.prediction(s_0 <span class="op">=</span> (<span class="dv">2</span>,<span class="dv">1</span>),π <span class="op">=</span> π,iter_nums <span class="op">=</span> <span class="dv">100000</span>,α <span class="op">=</span> <span class="fl">0.025</span>)</span>
<span id="cb19-4"><a href="#cb19-4"></a>V</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<pre><code>{(0, 0): 0,
 (0, 1): -13.468481120602783,
 (0, 2): -18.04521926868933,
 (0, 3): -20.830446568464893,
 (1, 0): -14.162405826062944,
 (1, 1): -17.51880803992086,
 (1, 2): -18.99287999167345,
 (1, 3): -19.31588268251589,
 (2, 0): -19.68613223150354,
 (2, 1): -19.616839196046627,
 (2, 2): -17.409760812877337,
 (2, 3): -12.103952443141019,
 (3, 0): -21.66401720239512,
 (3, 1): -19.851963302190605,
 (3, 2): -14.369576703234577,
 (3, 3): 0}</code></pre>
</div>
</div>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1"></a>td <span class="op">=</span> TD()</span>
<span id="cb21-2"><a href="#cb21-2"></a>π <span class="op">=</span> td.generate_π(<span class="va">True</span>)</span>
<span id="cb21-3"><a href="#cb21-3"></a>V <span class="op">=</span> td.prediction(s_0 <span class="op">=</span> (<span class="dv">2</span>,<span class="dv">1</span>),π <span class="op">=</span> π,iter_nums <span class="op">=</span> <span class="dv">100000</span>,α <span class="op">=</span> <span class="fl">0.001</span>)</span>
<span id="cb21-4"><a href="#cb21-4"></a>V</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre><code>{(0, 0): 0,
 (0, 1): -14.03275753892002,
 (0, 2): -20.120670066469458,
 (0, 3): -22.087632181402803,
 (1, 0): -14.356100397943504,
 (1, 1): -18.06656086981896,
 (1, 2): -20.057873409291272,
 (1, 3): -19.933245308012694,
 (2, 0): -20.11923861351503,
 (2, 1): -20.10721474631147,
 (2, 2): -18.017930371514616,
 (2, 3): -13.836185455422145,
 (3, 0): -22.0836078738287,
 (3, 1): -20.00180431090046,
 (3, 2): -14.000978315795132,
 (3, 3): 0}</code></pre>
</div>
</div>
<ul>
<li>It approximates the true value fairly well.</li>
<li>I wonder if increasing the number of iterations would increase the value? Is this really convergence?</li>
</ul>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1"></a>td <span class="op">=</span> TD()</span>
<span id="cb23-2"><a href="#cb23-2"></a>π <span class="op">=</span> td.generate_π(<span class="va">True</span>)</span>
<span id="cb23-3"><a href="#cb23-3"></a>V <span class="op">=</span> td.prediction(s_0 <span class="op">=</span> (<span class="dv">2</span>,<span class="dv">1</span>),π <span class="op">=</span> π,iter_nums <span class="op">=</span> <span class="dv">500000</span>,α <span class="op">=</span> <span class="fl">0.001</span>)</span>
<span id="cb23-4"><a href="#cb23-4"></a>V</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<pre><code>{(0, 0): 0,
 (0, 1): -14.023947065291312,
 (0, 2): -19.88466015535378,
 (0, 3): -22.019204023526456,
 (1, 0): -13.997593366671204,
 (1, 1): -17.867270764828138,
 (1, 2): -19.89726566201253,
 (1, 3): -19.982618186721407,
 (2, 0): -19.907105325573927,
 (2, 1): -19.89049628015864,
 (2, 2): -17.926426396792216,
 (2, 3): -13.883623908772902,
 (3, 0): -21.86589991111874,
 (3, 1): -19.918957752488122,
 (3, 2): -14.041869061880227,
 (3, 3): 0}</code></pre>
</div>
</div>
<ul>
<li>It seems to have converged.</li>
<li>Insight
<ol type="1">
<li>It was stated that decreasing <span class="math inline">\(\alpha\)</span> will always converge to True. However, decreasing <span class="math inline">\(\frac{1}{N}\)</span> did not converge to the true value. Perhaps we need to increase the decrease further.</li>
<li>The book said that if <span class="math inline">\(\alpha\)</span> is a constant, it will converge to True on average. In my experiments, as long as <span class="math inline">\(\alpha\)</span> is appropriate, 100% of them converged to the true value.</li>
<li>In TD, the step size alpha should be set small by default. I think it should be at most 0.01 and definitely less than that.</li>
</ol></li>
</ul>
</section>
</section>
<section id="sarsaon-policy-td-control" class="level1">
<h1>SARSA(On-Policy TD Control)</h1>
<span class="math display">\[\begin{aligned}
\pi(a|s) = \begin{cases}
1-\epsilon + \frac{\epsilon}{|A(s)|}\quad(A = \text{greedy action})\\
\epsilon /|A(s)| \quad\quad\quad\quad (\text{otherwise})
\end{cases}
\end{aligned}\]</span>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb25-2"><a href="#cb25-2"></a><span class="im">import</span> time</span>
<span id="cb25-3"><a href="#cb25-3"></a><span class="kw">class</span> Environment():</span>
<span id="cb25-4"><a href="#cb25-4"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>,grid_size):</span>
<span id="cb25-5"><a href="#cb25-5"></a>        <span class="va">self</span>.grid_size <span class="op">=</span> np.array(grid_size)</span>
<span id="cb25-6"><a href="#cb25-6"></a>        <span class="va">self</span>.S <span class="op">=</span> [np.array([i,j]) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(grid_size[<span class="dv">0</span>]) <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(grid_size[<span class="dv">1</span>])]</span>
<span id="cb25-7"><a href="#cb25-7"></a>        <span class="va">self</span>.Terminal_states <span class="op">=</span> [(<span class="dv">0</span>,<span class="dv">0</span>),(<span class="va">self</span>.grid_size[<span class="dv">0</span>]<span class="op">-</span><span class="dv">1</span>,<span class="va">self</span>.grid_size[<span class="dv">1</span>]<span class="op">-</span><span class="dv">1</span>)]</span>
<span id="cb25-8"><a href="#cb25-8"></a>        <span class="va">self</span>.A <span class="op">=</span> [<span class="st">"W"</span>,<span class="st">"E"</span>,<span class="st">"N"</span>,<span class="st">"S"</span>]</span>
<span id="cb25-9"><a href="#cb25-9"></a>        <span class="va">self</span>.A_to_coord <span class="op">=</span> {<span class="st">"W"</span> : [<span class="dv">0</span>,<span class="op">-</span><span class="dv">1</span>],<span class="st">"E"</span> : [<span class="dv">0</span>,<span class="dv">1</span>], <span class="st">"N"</span> : [<span class="op">-</span><span class="dv">1</span>,<span class="dv">0</span>], <span class="st">"S"</span> : [<span class="dv">1</span>,<span class="dv">0</span>]}</span>
<span id="cb25-10"><a href="#cb25-10"></a>        <span class="cf">for</span> k,v <span class="kw">in</span> <span class="va">self</span>.A_to_coord.items():</span>
<span id="cb25-11"><a href="#cb25-11"></a>            <span class="va">self</span>.A_to_coord[k] <span class="op">=</span> np.array(v)</span>
<span id="cb25-12"><a href="#cb25-12"></a>        <span class="va">self</span>.gamma <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb25-13"><a href="#cb25-13"></a>        <span class="va">self</span>.R <span class="op">=</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb25-14"><a href="#cb25-14"></a>    </span>
<span id="cb25-15"><a href="#cb25-15"></a>    <span class="kw">def</span> move(<span class="va">self</span>,s,a):</span>
<span id="cb25-16"><a href="#cb25-16"></a>        <span class="co">"""</span></span>
<span id="cb25-17"><a href="#cb25-17"></a><span class="co">        Input</span></span>
<span id="cb25-18"><a href="#cb25-18"></a><span class="co">        s : current_state(position)</span></span>
<span id="cb25-19"><a href="#cb25-19"></a><span class="co">        a : action(from deterministic policy π)</span></span>
<span id="cb25-20"><a href="#cb25-20"></a><span class="co">        output</span></span>
<span id="cb25-21"><a href="#cb25-21"></a><span class="co">        s_next : state after one_step transition</span></span>
<span id="cb25-22"><a href="#cb25-22"></a><span class="co">        ex)</span></span>
<span id="cb25-23"><a href="#cb25-23"></a><span class="co">        Input : s = [0,1],a = "W"</span></span>
<span id="cb25-24"><a href="#cb25-24"></a><span class="co">        Output : s_next = [0,0]</span></span>
<span id="cb25-25"><a href="#cb25-25"></a><span class="co">        """</span></span>
<span id="cb25-26"><a href="#cb25-26"></a>        s_next <span class="op">=</span> s <span class="op">+</span> <span class="va">self</span>.A_to_coord[a]</span>
<span id="cb25-27"><a href="#cb25-27"></a>        <span class="cf">if</span> s_next[<span class="dv">0</span>] <span class="op">&lt;</span> <span class="dv">0</span> <span class="kw">or</span> s_next[<span class="dv">1</span>] <span class="op">&lt;</span><span class="dv">0</span> <span class="kw">or</span> s_next[<span class="dv">0</span>] <span class="op">&gt;=</span> <span class="va">self</span>.grid_size[<span class="dv">0</span>] <span class="kw">or</span> s_next[<span class="dv">1</span>] <span class="op">&gt;=</span> <span class="va">self</span>.grid_size[<span class="dv">1</span>]:</span>
<span id="cb25-28"><a href="#cb25-28"></a>            <span class="cf">return</span> s <span class="co"># |S|를 넘어갈 경우, 원래 상태를 반환</span></span>
<span id="cb25-29"><a href="#cb25-29"></a>        <span class="cf">else</span>:</span>
<span id="cb25-30"><a href="#cb25-30"></a>            <span class="cf">return</span> s_next</span>
<span id="cb25-31"><a href="#cb25-31"></a>        </span>
<span id="cb25-32"><a href="#cb25-32"></a>    <span class="kw">def</span> move_test(<span class="va">self</span>):</span>
<span id="cb25-33"><a href="#cb25-33"></a>        S <span class="op">=</span> [np.array([i,j]) <span class="cf">for</span> i <span class="kw">in</span> [<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>] <span class="cf">for</span> j <span class="kw">in</span> [<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>]]</span>
<span id="cb25-34"><a href="#cb25-34"></a>        <span class="cf">for</span> s <span class="kw">in</span> S:</span>
<span id="cb25-35"><a href="#cb25-35"></a>            <span class="cf">for</span> a <span class="kw">in</span> <span class="va">self</span>.A:</span>
<span id="cb25-36"><a href="#cb25-36"></a>                <span class="bu">print</span>(s,a,<span class="va">self</span>.move(s,a))</span>
<span id="cb25-37"><a href="#cb25-37"></a>    <span class="kw">def</span> dynamics(<span class="va">self</span>,s_prime,r,s,a):</span>
<span id="cb25-38"><a href="#cb25-38"></a>        r<span class="op">=-</span><span class="dv">1</span></span>
<span id="cb25-39"><a href="#cb25-39"></a>        <span class="co">"""</span></span>
<span id="cb25-40"><a href="#cb25-40"></a><span class="co">        Input</span></span>
<span id="cb25-41"><a href="#cb25-41"></a><span class="co">        s : current_state(position)</span></span>
<span id="cb25-42"><a href="#cb25-42"></a><span class="co">        a : action(from deterministic policy π)</span></span>
<span id="cb25-43"><a href="#cb25-43"></a><span class="co">        s_prime : all of the possible states after one-step transition</span></span>
<span id="cb25-44"><a href="#cb25-44"></a><span class="co">        r : immediate reward(-1)</span></span>
<span id="cb25-45"><a href="#cb25-45"></a><span class="co">        output</span></span>
<span id="cb25-46"><a href="#cb25-46"></a><span class="co">        0 if s에서 a로 움직였을때의 변화된 상태 next_s와 s_prime의 input이 다를때</span></span>
<span id="cb25-47"><a href="#cb25-47"></a><span class="co">        1 if s에서 a로 움직였을때의 변화된 상태 next_s와 s_prime의 input이 같을때</span></span>
<span id="cb25-48"><a href="#cb25-48"></a><span class="co">        즉, a방향으로 움직이면 반드시 a방향으로 감(deterministic)</span></span>
<span id="cb25-49"><a href="#cb25-49"></a><span class="co">        """</span></span>
<span id="cb25-50"><a href="#cb25-50"></a>        s_next <span class="op">=</span> <span class="va">self</span>.move(s,a)</span>
<span id="cb25-51"><a href="#cb25-51"></a>        <span class="cf">if</span> np.<span class="bu">sum</span>(s_next <span class="op">!=</span> s_prime)<span class="op">&gt;=</span><span class="dv">1</span>:</span>
<span id="cb25-52"><a href="#cb25-52"></a>            <span class="cf">return</span> <span class="dv">0</span></span>
<span id="cb25-53"><a href="#cb25-53"></a>        <span class="cf">else</span>:</span>
<span id="cb25-54"><a href="#cb25-54"></a>            <span class="cf">return</span> <span class="dv">1</span></span>
<span id="cb25-55"><a href="#cb25-55"></a>    <span class="kw">def</span> dynamics_test(<span class="va">self</span>,check_p <span class="op">=</span> <span class="dv">1</span>):</span>
<span id="cb25-56"><a href="#cb25-56"></a>        r<span class="op">=-</span><span class="dv">1</span></span>
<span id="cb25-57"><a href="#cb25-57"></a>        <span class="cf">for</span> s <span class="kw">in</span> <span class="va">self</span>.S:</span>
<span id="cb25-58"><a href="#cb25-58"></a>            <span class="cf">for</span> a <span class="kw">in</span> <span class="va">self</span>.A:</span>
<span id="cb25-59"><a href="#cb25-59"></a>                <span class="cf">for</span> s_prime <span class="kw">in</span> <span class="va">self</span>.S: <span class="co">#가능한 모든 next_state</span></span>
<span id="cb25-60"><a href="#cb25-60"></a>                    <span class="cf">if</span> <span class="va">self</span>.dynamics(s_prime,r,s,a) <span class="op">==</span> check_p:</span>
<span id="cb25-61"><a href="#cb25-61"></a>                        <span class="bu">print</span>(<span class="ss">f"state : </span><span class="sc">{</span>s<span class="sc">}</span><span class="ss"> action : </span><span class="sc">{</span>a<span class="sc">}</span><span class="ss"> s_prime : </span><span class="sc">{</span>s_prime<span class="sc">}</span><span class="ss"> dynamics : </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>dynamics(s_prime,r,s,a)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb25-62"><a href="#cb25-62"></a>    <span class="kw">def</span> sampling_action(<span class="va">self</span>,s_t,π):</span>
<span id="cb25-63"><a href="#cb25-63"></a>        <span class="co">"""</span></span>
<span id="cb25-64"><a href="#cb25-64"></a><span class="co">        Input current state s_t : tuple</span></span>
<span id="cb25-65"><a href="#cb25-65"></a><span class="co">        ouput action : str (a ~ π(a|s))</span></span>
<span id="cb25-66"><a href="#cb25-66"></a><span class="co">        """</span></span>
<span id="cb25-67"><a href="#cb25-67"></a>        actions <span class="op">=</span> []</span>
<span id="cb25-68"><a href="#cb25-68"></a>        prob <span class="op">=</span> []</span>
<span id="cb25-69"><a href="#cb25-69"></a>        <span class="cf">for</span> a,p <span class="kw">in</span> π[s_t].items():</span>
<span id="cb25-70"><a href="#cb25-70"></a>            actions.append(a)</span>
<span id="cb25-71"><a href="#cb25-71"></a>            prob.append(p)</span>
<span id="cb25-72"><a href="#cb25-72"></a>        <span class="co">#print(prob)</span></span>
<span id="cb25-73"><a href="#cb25-73"></a>        <span class="cf">return</span> np.random.choice(a<span class="op">=</span>actions,p<span class="op">=</span>prob)</span>
<span id="cb25-74"><a href="#cb25-74"></a>    <span class="kw">def</span> generate_π(<span class="va">self</span>,uniform<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb25-75"><a href="#cb25-75"></a>        <span class="co">"""</span></span>
<span id="cb25-76"><a href="#cb25-76"></a><span class="co">        Input : NA</span></span>
<span id="cb25-77"><a href="#cb25-77"></a><span class="co">        Output : {(x,y) : {"W" : pr1,"E" : pr2 ,...}}</span></span>
<span id="cb25-78"><a href="#cb25-78"></a><span class="co">        ex)</span></span>
<span id="cb25-79"><a href="#cb25-79"></a><span class="co">        {(0,0):{"W" : 0.1, "E" : 0.2, ...},(0,1):{"W":0.4,"E":0.5...}}</span></span>
<span id="cb25-80"><a href="#cb25-80"></a><span class="co">        """</span></span>
<span id="cb25-81"><a href="#cb25-81"></a>        π <span class="op">=</span> {(i,j): {} <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>.grid_size[<span class="dv">0</span>]) <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>.grid_size[<span class="dv">1</span>])}</span>
<span id="cb25-82"><a href="#cb25-82"></a>        <span class="cf">for</span> t <span class="kw">in</span> π.values():</span>
<span id="cb25-83"><a href="#cb25-83"></a>            unnormalized_prob <span class="op">=</span> np.random.rand(<span class="dv">4</span>)</span>
<span id="cb25-84"><a href="#cb25-84"></a>            <span class="cf">if</span> uniform <span class="op">==</span> <span class="va">False</span>:</span>
<span id="cb25-85"><a href="#cb25-85"></a>                prob <span class="op">=</span> unnormalized_prob<span class="op">/</span>np.<span class="bu">sum</span>(unnormalized_prob)</span>
<span id="cb25-86"><a href="#cb25-86"></a>            <span class="cf">else</span>:</span>
<span id="cb25-87"><a href="#cb25-87"></a>                prob <span class="op">=</span> [<span class="fl">0.25</span>] <span class="op">*</span> <span class="dv">4</span></span>
<span id="cb25-88"><a href="#cb25-88"></a>            <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(<span class="va">self</span>.A)):</span>
<span id="cb25-89"><a href="#cb25-89"></a>                t[<span class="va">self</span>.A[i]] <span class="op">=</span> prob[i]</span>
<span id="cb25-90"><a href="#cb25-90"></a>        <span class="cf">return</span> π</span>
<span id="cb25-91"><a href="#cb25-91"></a>    <span class="kw">def</span> argmax_a_Q(<span class="va">self</span>,Q,s):</span>
<span id="cb25-92"><a href="#cb25-92"></a>        max_action <span class="op">=</span> <span class="st">"W"</span></span>
<span id="cb25-93"><a href="#cb25-93"></a>        max_value <span class="op">=</span> <span class="op">-</span><span class="dv">5000</span></span>
<span id="cb25-94"><a href="#cb25-94"></a>        <span class="cf">for</span> visit,Q_val <span class="kw">in</span> Q.items():</span>
<span id="cb25-95"><a href="#cb25-95"></a>            <span class="cf">if</span> visit[<span class="dv">0</span>] <span class="op">==</span> s:</span>
<span id="cb25-96"><a href="#cb25-96"></a>                <span class="cf">if</span> Q_val <span class="op">&gt;</span> max_value:</span>
<span id="cb25-97"><a href="#cb25-97"></a>                    max_action <span class="op">=</span> visit[<span class="dv">1</span>]</span>
<span id="cb25-98"><a href="#cb25-98"></a>                    max_value <span class="op">=</span> Q_val                    </span>
<span id="cb25-99"><a href="#cb25-99"></a>        <span class="cf">return</span> max_action</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1"></a><span class="kw">class</span> SARSA(Environment):</span>
<span id="cb26-2"><a href="#cb26-2"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>,grid_size<span class="op">=</span>(<span class="dv">4</span>,<span class="dv">4</span>)):</span>
<span id="cb26-3"><a href="#cb26-3"></a>        <span class="bu">super</span>().<span class="fu">__init__</span>(grid_size)</span>
<span id="cb26-4"><a href="#cb26-4"></a>    <span class="kw">def</span> control(<span class="va">self</span>,s_0,iter_nums,α<span class="op">=</span><span class="fl">0.9</span>,ϵ <span class="op">=</span> <span class="fl">0.9995</span>):</span>
<span id="cb26-5"><a href="#cb26-5"></a>        Q <span class="op">=</span> {(<span class="bu">tuple</span>(s),a):<span class="dv">0</span> <span class="cf">for</span> s <span class="kw">in</span> <span class="va">self</span>.S <span class="cf">for</span> a <span class="kw">in</span> <span class="va">self</span>.A}</span>
<span id="cb26-6"><a href="#cb26-6"></a>        π <span class="op">=</span> <span class="va">self</span>.generate_π()</span>
<span id="cb26-7"><a href="#cb26-7"></a>        action_space_size <span class="op">=</span> <span class="bu">len</span>(<span class="va">self</span>.A)</span>
<span id="cb26-8"><a href="#cb26-8"></a>        </span>
<span id="cb26-9"><a href="#cb26-9"></a>        count<span class="op">=</span><span class="dv">0</span></span>
<span id="cb26-10"><a href="#cb26-10"></a>        <span class="cf">for</span> ep_num <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,iter_nums):</span>
<span id="cb26-11"><a href="#cb26-11"></a>            s_t <span class="op">=</span> s_0<span class="op">;</span>a <span class="op">=</span> <span class="va">self</span>.sampling_action(s_0,π)</span>
<span id="cb26-12"><a href="#cb26-12"></a>            a_t <span class="op">=</span> <span class="va">self</span>.sampling_action(s_t,π)</span>
<span id="cb26-13"><a href="#cb26-13"></a>            epsilon <span class="op">=</span> ϵ <span class="co">#실수한 부분</span></span>
<span id="cb26-14"><a href="#cb26-14"></a>            alpha <span class="op">=</span> α <span class="co">#GLIE?</span></span>
<span id="cb26-15"><a href="#cb26-15"></a>            </span>
<span id="cb26-16"><a href="#cb26-16"></a>            <span class="cf">if</span> ep_num <span class="op">%</span> <span class="dv">1000</span> <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb26-17"><a href="#cb26-17"></a>                <span class="bu">print</span>(<span class="ss">f"episode : </span><span class="sc">{</span>ep_num<span class="sc">}</span><span class="ss">, epsilon : </span><span class="sc">{</span>epsilon<span class="sc">}</span><span class="ss">, alpha : </span><span class="sc">{</span>alpha<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb26-18"><a href="#cb26-18"></a>            </span>
<span id="cb26-19"><a href="#cb26-19"></a>            <span class="cf">while</span> s_t <span class="kw">not</span> <span class="kw">in</span> <span class="va">self</span>.Terminal_states:</span>
<span id="cb26-20"><a href="#cb26-20"></a>                count<span class="op">+=</span><span class="dv">1</span></span>
<span id="cb26-21"><a href="#cb26-21"></a>                r,s_prime <span class="op">=</span> <span class="op">-</span><span class="dv">1</span>,<span class="bu">tuple</span>(<span class="va">self</span>.move(s_t,a_t))</span>
<span id="cb26-22"><a href="#cb26-22"></a>                <span class="co">#sampling action ~ ϵ-greedy action</span></span>
<span id="cb26-23"><a href="#cb26-23"></a>                <span class="co">#1. make ϵ-greedy policy</span></span>
<span id="cb26-24"><a href="#cb26-24"></a>                a_star <span class="op">=</span> <span class="va">self</span>.argmax_a_Q(Q,s_prime)</span>
<span id="cb26-25"><a href="#cb26-25"></a>                <span class="cf">for</span> action,prob <span class="kw">in</span> π[s_prime].items():</span>
<span id="cb26-26"><a href="#cb26-26"></a>                    <span class="cf">if</span> action <span class="op">==</span> a_star:</span>
<span id="cb26-27"><a href="#cb26-27"></a>                        π[s_prime][action] <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> epsilon <span class="op">+</span> epsilon<span class="op">/</span>action_space_size</span>
<span id="cb26-28"><a href="#cb26-28"></a>                    <span class="cf">else</span>:</span>
<span id="cb26-29"><a href="#cb26-29"></a>                        π[s_prime][action] <span class="op">=</span> epsilon<span class="op">/</span>action_space_size</span>
<span id="cb26-30"><a href="#cb26-30"></a>                <span class="co">#2. sampling action</span></span>
<span id="cb26-31"><a href="#cb26-31"></a>                a_prime <span class="op">=</span> <span class="va">self</span>.sampling_action(s_prime,π)</span>
<span id="cb26-32"><a href="#cb26-32"></a>                Q[(s_t,a_t)] <span class="op">=</span> Q[(s_t,a_t)] <span class="op">+</span> alpha<span class="op">*</span>(r <span class="op">+</span> <span class="dv">1</span><span class="op">*</span>Q[(s_prime,a_prime)] <span class="op">-</span> Q[(s_t,a_t)])</span>
<span id="cb26-33"><a href="#cb26-33"></a>                <span class="co">#print(alpha*(r + 1*Q[(s_prime,a_prime)] - Q[(s_t,a_t)]))</span></span>
<span id="cb26-34"><a href="#cb26-34"></a>                s_t <span class="op">=</span> s_prime<span class="op">;</span>a_t <span class="op">=</span> a_prime</span>
<span id="cb26-35"><a href="#cb26-35"></a>                count<span class="op">+=</span><span class="dv">1</span></span>
<span id="cb26-36"><a href="#cb26-36"></a>        <span class="cf">return</span> Q,π</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1"></a><span class="kw">def</span> difference(q_π,Q):</span>
<span id="cb27-2"><a href="#cb27-2"></a>    true_val <span class="op">=</span> []</span>
<span id="cb27-3"><a href="#cb27-3"></a>    approx_val <span class="op">=</span> []</span>
<span id="cb27-4"><a href="#cb27-4"></a>    <span class="cf">for</span> k,v <span class="kw">in</span> q_π.items():</span>
<span id="cb27-5"><a href="#cb27-5"></a>        true_val.append(v)</span>
<span id="cb27-6"><a href="#cb27-6"></a>    <span class="cf">for</span> k,v <span class="kw">in</span> Q.items():</span>
<span id="cb27-7"><a href="#cb27-7"></a>        approx_val.append(v)</span>
<span id="cb27-8"><a href="#cb27-8"></a>    <span class="cf">return</span> ((np.array(true_val) <span class="op">-</span> np.array(approx_val))<span class="op">**</span><span class="dv">2</span>)<span class="op">**</span>(<span class="dv">1</span><span class="op">/</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1"></a>sarsa <span class="op">=</span> SARSA()</span>
<span id="cb28-2"><a href="#cb28-2"></a>Q,π <span class="op">=</span> sarsa.control(s_0 <span class="op">=</span> (<span class="dv">2</span>,<span class="dv">1</span>),iter_nums <span class="op">=</span> <span class="dv">10000</span>,α <span class="op">=</span> <span class="fl">0.9</span>,ϵ <span class="op">=</span> <span class="fl">0.9</span>)</span>
<span id="cb28-3"><a href="#cb28-3"></a>rmse <span class="op">=</span> difference(q_star,Q)</span>
<span id="cb28-4"><a href="#cb28-4"></a>np.<span class="bu">sum</span>(rmse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>episode : 1000, epsilon : 0.9, alpha : 0.9
episode : 2000, epsilon : 0.9, alpha : 0.9
episode : 3000, epsilon : 0.9, alpha : 0.9
episode : 4000, epsilon : 0.9, alpha : 0.9
episode : 5000, epsilon : 0.9, alpha : 0.9
episode : 6000, epsilon : 0.9, alpha : 0.9
episode : 7000, epsilon : 0.9, alpha : 0.9
episode : 8000, epsilon : 0.9, alpha : 0.9
episode : 9000, epsilon : 0.9, alpha : 0.9</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="11">
<pre><code>483.8118478775802</code></pre>
</div>
</div>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1"></a>sarsa <span class="op">=</span> SARSA()</span>
<span id="cb31-2"><a href="#cb31-2"></a>Q,π <span class="op">=</span> sarsa.control(s_0 <span class="op">=</span> (<span class="dv">2</span>,<span class="dv">1</span>),iter_nums <span class="op">=</span> <span class="dv">10000</span>,α <span class="op">=</span> <span class="fl">0.5</span>,ϵ <span class="op">=</span> <span class="fl">0.9</span>)</span>
<span id="cb31-3"><a href="#cb31-3"></a>rmse <span class="op">=</span> difference(q_star,Q)</span>
<span id="cb31-4"><a href="#cb31-4"></a>np.<span class="bu">sum</span>(rmse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>episode : 1000, epsilon : 0.9, alpha : 0.5
episode : 2000, epsilon : 0.9, alpha : 0.5
episode : 3000, epsilon : 0.9, alpha : 0.5
episode : 4000, epsilon : 0.9, alpha : 0.5
episode : 5000, epsilon : 0.9, alpha : 0.5
episode : 6000, epsilon : 0.9, alpha : 0.5
episode : 7000, epsilon : 0.9, alpha : 0.5
episode : 8000, epsilon : 0.9, alpha : 0.5
episode : 9000, epsilon : 0.9, alpha : 0.5</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="12">
<pre><code>556.6158724643351</code></pre>
</div>
</div>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1"></a>sarsa <span class="op">=</span> SARSA()</span>
<span id="cb34-2"><a href="#cb34-2"></a>Q,π <span class="op">=</span> sarsa.control(s_0 <span class="op">=</span> (<span class="dv">2</span>,<span class="dv">1</span>),iter_nums <span class="op">=</span> <span class="dv">10000</span>,α <span class="op">=</span> <span class="fl">0.9</span>,ϵ <span class="op">=</span> <span class="fl">0.5</span>)</span>
<span id="cb34-3"><a href="#cb34-3"></a>rmse <span class="op">=</span> difference(q_star,Q)</span>
<span id="cb34-4"><a href="#cb34-4"></a>np.<span class="bu">sum</span>(rmse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>episode : 1000, epsilon : 0.5, alpha : 0.9
episode : 2000, epsilon : 0.5, alpha : 0.9
episode : 3000, epsilon : 0.5, alpha : 0.9
episode : 4000, epsilon : 0.5, alpha : 0.9
episode : 5000, epsilon : 0.5, alpha : 0.9
episode : 6000, epsilon : 0.5, alpha : 0.9
episode : 7000, epsilon : 0.5, alpha : 0.9
episode : 8000, epsilon : 0.5, alpha : 0.9
episode : 9000, epsilon : 0.5, alpha : 0.9</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre><code>200.9279392085909</code></pre>
</div>
</div>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1"></a>sarsa <span class="op">=</span> SARSA()</span>
<span id="cb37-2"><a href="#cb37-2"></a>Q,π <span class="op">=</span> sarsa.control(s_0 <span class="op">=</span> (<span class="dv">2</span>,<span class="dv">1</span>),iter_nums <span class="op">=</span> <span class="dv">10000</span>,α <span class="op">=</span> <span class="fl">0.2</span>,ϵ <span class="op">=</span> <span class="fl">0.5</span>)</span>
<span id="cb37-3"><a href="#cb37-3"></a>rmse <span class="op">=</span> difference(q_star,Q)</span>
<span id="cb37-4"><a href="#cb37-4"></a>np.<span class="bu">sum</span>(rmse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>episode : 1000, epsilon : 0.5, alpha : 0.2
episode : 2000, epsilon : 0.5, alpha : 0.2
episode : 3000, epsilon : 0.5, alpha : 0.2
episode : 4000, epsilon : 0.5, alpha : 0.2
episode : 5000, epsilon : 0.5, alpha : 0.2
episode : 6000, epsilon : 0.5, alpha : 0.2
episode : 7000, epsilon : 0.5, alpha : 0.2
episode : 8000, epsilon : 0.5, alpha : 0.2
episode : 9000, epsilon : 0.5, alpha : 0.2</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="14">
<pre><code>125.00452426936465</code></pre>
</div>
</div>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1"></a>sarsa <span class="op">=</span> SARSA()</span>
<span id="cb40-2"><a href="#cb40-2"></a>Q,π <span class="op">=</span> sarsa.control(s_0 <span class="op">=</span> (<span class="dv">2</span>,<span class="dv">1</span>),iter_nums <span class="op">=</span> <span class="dv">10000</span>,α <span class="op">=</span> <span class="fl">0.5</span>,ϵ <span class="op">=</span> <span class="fl">0.2</span>)</span>
<span id="cb40-3"><a href="#cb40-3"></a>rmse <span class="op">=</span> difference(q_star,Q)</span>
<span id="cb40-4"><a href="#cb40-4"></a>np.<span class="bu">sum</span>(rmse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>episode : 1000, epsilon : 0.2, alpha : 0.5
episode : 2000, epsilon : 0.2, alpha : 0.5
episode : 3000, epsilon : 0.2, alpha : 0.5
episode : 4000, epsilon : 0.2, alpha : 0.5
episode : 5000, epsilon : 0.2, alpha : 0.5
episode : 6000, epsilon : 0.2, alpha : 0.5
episode : 7000, epsilon : 0.2, alpha : 0.5
episode : 8000, epsilon : 0.2, alpha : 0.5
episode : 9000, epsilon : 0.2, alpha : 0.5</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="15">
<pre><code>53.490927304402234</code></pre>
</div>
</div>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1"></a>sarsa <span class="op">=</span> SARSA()</span>
<span id="cb43-2"><a href="#cb43-2"></a>Q,π <span class="op">=</span> sarsa.control(s_0 <span class="op">=</span> (<span class="dv">2</span>,<span class="dv">1</span>),iter_nums <span class="op">=</span> <span class="dv">10000</span>,α <span class="op">=</span> <span class="fl">0.01</span>,ϵ <span class="op">=</span> <span class="fl">0.2</span>)</span>
<span id="cb43-3"><a href="#cb43-3"></a>rmse <span class="op">=</span> difference(q_star,Q)</span>
<span id="cb43-4"><a href="#cb43-4"></a>np.<span class="bu">sum</span>(rmse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>episode : 1000, epsilon : 0.2, alpha : 0.01
episode : 2000, epsilon : 0.2, alpha : 0.01
episode : 3000, epsilon : 0.2, alpha : 0.01
episode : 4000, epsilon : 0.2, alpha : 0.01
episode : 5000, epsilon : 0.2, alpha : 0.01
episode : 6000, epsilon : 0.2, alpha : 0.01
episode : 7000, epsilon : 0.2, alpha : 0.01
episode : 8000, epsilon : 0.2, alpha : 0.01
episode : 9000, epsilon : 0.2, alpha : 0.01</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="16">
<pre><code>36.054180468348434</code></pre>
</div>
</div>
<ul>
<li>Here I remembered that there are some conditions for the salsa algorithm to converge.</li>
<li>GLIE, Robbins-Monro sequence of step-size <span class="math inline">\(\alpha_t\)</span></li>
</ul>
<strong>(GLIE)</strong>
<strong>(Robbins-Monro)</strong>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1"></a><span class="kw">class</span> SARSA(Environment):</span>
<span id="cb46-2"><a href="#cb46-2"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>,grid_size<span class="op">=</span>(<span class="dv">4</span>,<span class="dv">4</span>)):</span>
<span id="cb46-3"><a href="#cb46-3"></a>        <span class="bu">super</span>().<span class="fu">__init__</span>(grid_size)</span>
<span id="cb46-4"><a href="#cb46-4"></a>    <span class="kw">def</span> control(<span class="va">self</span>,s_0,iter_nums,α<span class="op">=</span><span class="fl">0.9</span>,ϵ <span class="op">=</span> <span class="fl">0.9995</span>):</span>
<span id="cb46-5"><a href="#cb46-5"></a>        Q <span class="op">=</span> {(<span class="bu">tuple</span>(s),a):<span class="dv">0</span> <span class="cf">for</span> s <span class="kw">in</span> <span class="va">self</span>.S <span class="cf">for</span> a <span class="kw">in</span> <span class="va">self</span>.A}</span>
<span id="cb46-6"><a href="#cb46-6"></a>        π <span class="op">=</span> <span class="va">self</span>.generate_π()</span>
<span id="cb46-7"><a href="#cb46-7"></a>        action_space_size <span class="op">=</span> <span class="bu">len</span>(<span class="va">self</span>.A)</span>
<span id="cb46-8"><a href="#cb46-8"></a>        </span>
<span id="cb46-9"><a href="#cb46-9"></a>        count<span class="op">=</span><span class="dv">0</span></span>
<span id="cb46-10"><a href="#cb46-10"></a>        <span class="cf">for</span> ep_num <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,iter_nums):</span>
<span id="cb46-11"><a href="#cb46-11"></a>            s_t <span class="op">=</span> s_0<span class="op">;</span>a <span class="op">=</span> <span class="va">self</span>.sampling_action(s_0,π)</span>
<span id="cb46-12"><a href="#cb46-12"></a>            a_t <span class="op">=</span> <span class="va">self</span>.sampling_action(s_t,π)</span>
<span id="cb46-13"><a href="#cb46-13"></a>            epsilon <span class="op">=</span> ϵ <span class="op">**</span> (ep_num <span class="op">+</span> <span class="dv">1</span>) <span class="co">#실수한 부분</span></span>
<span id="cb46-14"><a href="#cb46-14"></a>            alpha <span class="op">=</span> α<span class="op">**</span>(ep_num<span class="op">+</span><span class="dv">1</span>) <span class="co">#GLIE?</span></span>
<span id="cb46-15"><a href="#cb46-15"></a>            </span>
<span id="cb46-16"><a href="#cb46-16"></a>            <span class="cf">if</span> ep_num <span class="op">%</span> (iter_nums <span class="op">/</span> <span class="dv">10</span>) <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb46-17"><a href="#cb46-17"></a>                <span class="bu">print</span>(<span class="ss">f"episode : </span><span class="sc">{</span>ep_num<span class="sc">}</span><span class="ss">, epsilon : </span><span class="sc">{</span>epsilon<span class="sc">}</span><span class="ss">, alpha : </span><span class="sc">{</span>alpha<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb46-18"><a href="#cb46-18"></a>            </span>
<span id="cb46-19"><a href="#cb46-19"></a>            <span class="cf">while</span> s_t <span class="kw">not</span> <span class="kw">in</span> <span class="va">self</span>.Terminal_states:</span>
<span id="cb46-20"><a href="#cb46-20"></a>                count<span class="op">+=</span><span class="dv">1</span></span>
<span id="cb46-21"><a href="#cb46-21"></a>                r,s_prime <span class="op">=</span> <span class="op">-</span><span class="dv">1</span>,<span class="bu">tuple</span>(<span class="va">self</span>.move(s_t,a_t))</span>
<span id="cb46-22"><a href="#cb46-22"></a>                <span class="co">#sampling action ~ ϵ-greedy action</span></span>
<span id="cb46-23"><a href="#cb46-23"></a>                <span class="co">#1. make ϵ-greedy policy</span></span>
<span id="cb46-24"><a href="#cb46-24"></a>                a_star <span class="op">=</span> <span class="va">self</span>.argmax_a_Q(Q,s_prime)</span>
<span id="cb46-25"><a href="#cb46-25"></a>                <span class="cf">for</span> action,prob <span class="kw">in</span> π[s_prime].items():</span>
<span id="cb46-26"><a href="#cb46-26"></a>                    <span class="cf">if</span> action <span class="op">==</span> a_star:</span>
<span id="cb46-27"><a href="#cb46-27"></a>                        π[s_prime][action] <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> epsilon <span class="op">+</span> epsilon<span class="op">/</span>action_space_size</span>
<span id="cb46-28"><a href="#cb46-28"></a>                    <span class="cf">else</span>:</span>
<span id="cb46-29"><a href="#cb46-29"></a>                        π[s_prime][action] <span class="op">=</span> epsilon<span class="op">/</span>action_space_size</span>
<span id="cb46-30"><a href="#cb46-30"></a>                <span class="co">#2. sampling action</span></span>
<span id="cb46-31"><a href="#cb46-31"></a>                a_prime <span class="op">=</span> <span class="va">self</span>.sampling_action(s_prime,π)</span>
<span id="cb46-32"><a href="#cb46-32"></a>                Q[(s_t,a_t)] <span class="op">=</span> Q[(s_t,a_t)] <span class="op">+</span> alpha<span class="op">*</span>(r <span class="op">+</span> <span class="dv">1</span><span class="op">*</span>Q[(s_prime,a_prime)] <span class="op">-</span> Q[(s_t,a_t)])</span>
<span id="cb46-33"><a href="#cb46-33"></a>                <span class="co">#print(alpha*(r + 1*Q[(s_prime,a_prime)] - Q[(s_t,a_t)]))</span></span>
<span id="cb46-34"><a href="#cb46-34"></a>                s_t <span class="op">=</span> s_prime<span class="op">;</span>a_t <span class="op">=</span> a_prime</span>
<span id="cb46-35"><a href="#cb46-35"></a>                count<span class="op">+=</span><span class="dv">1</span></span>
<span id="cb46-36"><a href="#cb46-36"></a>        <span class="cf">return</span> Q,π</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1"></a>sarsa <span class="op">=</span> SARSA()</span>
<span id="cb47-2"><a href="#cb47-2"></a>Q,π <span class="op">=</span> sarsa.control(s_0 <span class="op">=</span> (<span class="dv">2</span>,<span class="dv">1</span>),iter_nums <span class="op">=</span> <span class="dv">10000</span>,α <span class="op">=</span> np.exp(np.log(<span class="fl">0.0001</span>)<span class="op">/</span><span class="dv">10000</span>),ϵ <span class="op">=</span> <span class="fl">0.9999</span>)</span>
<span id="cb47-3"><a href="#cb47-3"></a>rmse <span class="op">=</span> difference(q_star,Q)</span>
<span id="cb47-4"><a href="#cb47-4"></a>np.<span class="bu">sum</span>(rmse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>episode : 1000, epsilon : 0.9047424102692003, alpha : 0.3977406691050303
episode : 2000, epsilon : 0.818640693009023, alpha : 0.1583434123914593
episode : 3000, epsilon : 0.740733027040136, alpha : 0.06303764788294978
episode : 4000, epsilon : 0.6702396082111145, alpha : 0.025095739637028935
episode : 5000, epsilon : 0.6064548440752158, alpha : 0.009990793899844896
episode : 6000, epsilon : 0.5487402913771806, alpha : 0.003977406691050414
episode : 7000, epsilon : 0.49651826565897955, alpha : 0.0015834341239146371
episode : 8000, epsilon : 0.4492660590208904, alpha : 0.0006303764788295154
episode : 9000, epsilon : 0.40651070816152135, alpha : 0.00025095739637029634</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="19">
<pre><code>248.8158378933288</code></pre>
</div>
</div>
<ul>
<li>Once again, I see that the SARSA algorithm will not converge if the GLIE condition is not met.</li>
</ul>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1"></a>sarsa <span class="op">=</span> SARSA()</span>
<span id="cb50-2"><a href="#cb50-2"></a>Q,π <span class="op">=</span> sarsa.control(s_0 <span class="op">=</span> (<span class="dv">2</span>,<span class="dv">1</span>),iter_nums <span class="op">=</span> <span class="dv">10000</span>,α <span class="op">=</span> np.exp(np.log(<span class="fl">0.0001</span>)<span class="op">/</span><span class="dv">100000</span>),ϵ <span class="op">=</span> <span class="fl">0.999</span>)</span>
<span id="cb50-3"><a href="#cb50-3"></a>rmse <span class="op">=</span> difference(q_star,Q)</span>
<span id="cb50-4"><a href="#cb50-4"></a>np.<span class="bu">sum</span>(rmse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>episode : 1000, epsilon : 0.36732772934619273, alpha : 0.9119268439216149
episode : 2000, epsilon : 0.13506472547210194, alpha : 0.8316871663561808
episode : 3000, epsilon : 0.049662681604038125, alpha : 0.7585077106700777
episode : 4000, epsilon : 0.018260740807661924, alpha : 0.6917672538661829
episode : 5000, epsilon : 0.006714390847905722, alpha : 0.6308992338374627
episode : 6000, epsilon : 0.002468850794898966, alpha : 0.5753869398011344
episode : 7000, epsilon : 0.0009077851417265067, alpha : 0.5247591259224881
episode : 8000, epsilon : 0.0003337884432878974, alpha : 0.4785860108922666
episode : 9000, epsilon : 0.00012273248343838214, alpha : 0.43647562949787516</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="21">
<pre><code>138.7147404680331</code></pre>
</div>
</div>
<ul>
<li>Once again, I see that the SARSA algorithm will not converge if the Robbins-Monro condition is not met.</li>
</ul>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1"></a>sarsa <span class="op">=</span> SARSA()</span>
<span id="cb53-2"><a href="#cb53-2"></a>Q,π <span class="op">=</span> sarsa.control(s_0 <span class="op">=</span> (<span class="dv">2</span>,<span class="dv">1</span>),iter_nums <span class="op">=</span> <span class="dv">100000</span>,α <span class="op">=</span> np.exp(np.log(<span class="fl">0.0001</span>)<span class="op">/</span><span class="dv">100000</span>),ϵ <span class="op">=</span> <span class="fl">0.9999</span>)</span>
<span id="cb53-3"><a href="#cb53-3"></a>rmse <span class="op">=</span> difference(q_star,Q)</span>
<span id="cb53-4"><a href="#cb53-4"></a>np.<span class="bu">sum</span>(rmse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>episode : 10000, epsilon : 0.36782426032832716, alpha : 0.3980705052167768
episode : 20000, epsilon : 0.13530821730781176, alpha : 0.15847472251273403
episode : 30000, epsilon : 0.049774622409831396, alpha : 0.06308992338382775
episode : 40000, epsilon : 0.01831014468548656, alpha : 0.025116550888785564
episode : 50000, epsilon : 0.006735588984342178, alpha : 0.009999079008402512
episode : 60000, epsilon : 0.0024777608121225024, alpha : 0.003980705052178049
episode : 70000, epsilon : 0.0009114716851579903, alpha : 0.0015847472251314335
episode : 80000, epsilon : 0.00033529492789624127, alpha : 0.000630899233839907
episode : 90000, epsilon : 0.0001233419430395787, alpha : 0.0002511655088885044</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="20">
<pre><code>23.817640205236938</code></pre>
</div>
</div>
<ul>
<li>Here, I see that the SARSA algorithm gradually converges to the GLIE and Robbins-monro conditions.</li>
<li>I’ve also seen that by increasing the number of iterations here, I can approach the optimal action value function and policy</li>
</ul>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1"></a>sarsa <span class="op">=</span> SARSA()</span>
<span id="cb56-2"><a href="#cb56-2"></a>Q,π <span class="op">=</span> sarsa.control(s_0 <span class="op">=</span> (<span class="dv">2</span>,<span class="dv">1</span>),iter_nums <span class="op">=</span> <span class="dv">1000000</span>,α <span class="op">=</span> np.exp(np.log(<span class="fl">0.0001</span>)<span class="op">/</span><span class="dv">1000000</span>),ϵ <span class="op">=</span> <span class="fl">0.99999</span>)</span>
<span id="cb56-3"><a href="#cb56-3"></a>rmse <span class="op">=</span> difference(q_star,Q)</span>
<span id="cb56-4"><a href="#cb56-4"></a>np.<span class="bu">sum</span>(rmse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>episode : 100000, epsilon : 0.3678739229922288, alpha : 0.3981035038657425
episode : 200000, epsilon : 0.13533257654345773, alpha : 0.15848785951058994
episode : 300000, epsilon : 0.04978582369992489, alpha : 0.06309515331650908
episode : 400000, epsilon : 0.018315089424785096, alpha : 0.025118632962342347
episode : 500000, epsilon : 0.006737711173760915, alpha : 0.009999907896757296
episode : 600000, epsilon : 0.0024786530280102824, alpha : 0.00398103503855267
episode : 700000, epsilon : 0.0009118409315600251, alpha : 0.0015848785950641953
episode : 800000, epsilon : 0.0003354458550964258, alpha : 0.0006309515331484882
episode : 900000, epsilon : 0.00012340301669597187, alpha : 0.0002511863296168138</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="22">
<pre><code>8.850716178450071</code></pre>
</div>
</div>
<ul>
<li>It seems to have converged.</li>
<li>Insight
<ol type="1">
<li>The SARSA algorithm converges only when the GLIE and Robbins-monro conditions are satisfied.</li>
<li>It is very slow to converge.</li>
</ol></li>
</ul>
</section>
<section id="q-learning" class="level1">
<h1>Q-learning</h1>
<div class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1"></a><span class="kw">class</span> Q_learning(Environment):</span>
<span id="cb59-2"><a href="#cb59-2"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>,grid_size<span class="op">=</span>(<span class="dv">4</span>,<span class="dv">4</span>)):</span>
<span id="cb59-3"><a href="#cb59-3"></a>        <span class="bu">super</span>().<span class="fu">__init__</span>(grid_size)</span>
<span id="cb59-4"><a href="#cb59-4"></a>    </span>
<span id="cb59-5"><a href="#cb59-5"></a>    <span class="kw">def</span> control(<span class="va">self</span>,s_0,iter_num,alpha,epsilon):</span>
<span id="cb59-6"><a href="#cb59-6"></a>        Q <span class="op">=</span> {(<span class="bu">tuple</span>(s),a) : <span class="dv">0</span> <span class="cf">for</span> s <span class="kw">in</span> <span class="va">self</span>.S <span class="cf">for</span> a <span class="kw">in</span> <span class="va">self</span>.A}</span>
<span id="cb59-7"><a href="#cb59-7"></a>        π <span class="op">=</span> <span class="va">self</span>.generate_π()</span>
<span id="cb59-8"><a href="#cb59-8"></a>        γ <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb59-9"><a href="#cb59-9"></a>        <span class="cf">for</span> ep_num <span class="kw">in</span> <span class="bu">range</span>(iter_num):</span>
<span id="cb59-10"><a href="#cb59-10"></a>            ϵ <span class="op">=</span> epsilon <span class="op">**</span> (ep_num <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb59-11"><a href="#cb59-11"></a>            α <span class="op">=</span> alpha <span class="op">**</span> (ep_num <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb59-12"><a href="#cb59-12"></a>            <span class="cf">if</span> ep_num <span class="op">%</span> (iter_num <span class="op">/</span> <span class="dv">10</span>) <span class="op">==</span> <span class="va">True</span>:</span>
<span id="cb59-13"><a href="#cb59-13"></a>                <span class="bu">print</span>(<span class="ss">f"epsilon : </span><span class="sc">{ϵ}</span><span class="ss"> alpha : </span><span class="sc">{α}</span><span class="ss">"</span>)</span>
<span id="cb59-14"><a href="#cb59-14"></a>            s_t <span class="op">=</span> s_0</span>
<span id="cb59-15"><a href="#cb59-15"></a>            <span class="cf">while</span> s_t <span class="kw">not</span> <span class="kw">in</span> <span class="va">self</span>.Terminal_states:</span>
<span id="cb59-16"><a href="#cb59-16"></a>                a_t <span class="op">=</span> <span class="va">self</span>.sampling_action(s_t,π)</span>
<span id="cb59-17"><a href="#cb59-17"></a>                r,s_prime <span class="op">=</span> <span class="op">-</span><span class="dv">1</span>,<span class="bu">tuple</span>(<span class="va">self</span>.move(s_t,a_t))</span>
<span id="cb59-18"><a href="#cb59-18"></a>                Q[(s_t,a_t)] <span class="op">=</span> Q[(s_t,a_t)] <span class="op">+</span> α <span class="op">*</span> (r <span class="op">+</span> γ <span class="op">*</span> Q[(s_prime,<span class="va">self</span>.argmax_a_Q(Q,s_prime))] <span class="op">-</span> Q[(s_t,a_t)])</span>
<span id="cb59-19"><a href="#cb59-19"></a>                </span>
<span id="cb59-20"><a href="#cb59-20"></a>                a_star <span class="op">=</span> <span class="va">self</span>.argmax_a_Q(Q,<span class="bu">tuple</span>(s_t))</span>
<span id="cb59-21"><a href="#cb59-21"></a>                <span class="cf">for</span> (state,action),value <span class="kw">in</span> Q.items():</span>
<span id="cb59-22"><a href="#cb59-22"></a>                    <span class="cf">if</span> action <span class="op">==</span> a_star:</span>
<span id="cb59-23"><a href="#cb59-23"></a>                        π[state][action] <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> ϵ <span class="op">+</span> ϵ <span class="op">/</span><span class="bu">len</span>(<span class="va">self</span>.A)</span>
<span id="cb59-24"><a href="#cb59-24"></a>                    <span class="cf">else</span>:</span>
<span id="cb59-25"><a href="#cb59-25"></a>                        π[state][action] <span class="op">=</span> ϵ<span class="op">/</span><span class="bu">len</span>(<span class="va">self</span>.A)</span>
<span id="cb59-26"><a href="#cb59-26"></a>                s_t <span class="op">=</span> s_prime</span>
<span id="cb59-27"><a href="#cb59-27"></a>        <span class="cf">return</span> π,Q</span>
<span id="cb59-28"><a href="#cb59-28"></a>                </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1"></a>q_l <span class="op">=</span> Q_learning()</span>
<span id="cb60-2"><a href="#cb60-2"></a>π,Q<span class="op">=</span> q_l.control(s_0 <span class="op">=</span> (<span class="dv">2</span>,<span class="dv">1</span>),iter_num <span class="op">=</span> <span class="dv">1000</span>,alpha <span class="op">=</span> np.exp(np.log(<span class="fl">0.001</span>)<span class="op">/</span><span class="dv">1000</span>),epsilon <span class="op">=</span> <span class="fl">0.995</span>)</span>
<span id="cb60-3"><a href="#cb60-3"></a>rmse <span class="op">=</span> difference(q_star,Q)</span>
<span id="cb60-4"><a href="#cb60-4"></a>np.<span class="bu">sum</span>(rmse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>epsilon : 0.990025 alpha : 0.9862794856312106
epsilon : 0.599727876386733 alpha : 0.4943106869868377
epsilon : 0.36329741745444855 alpha : 0.24774220576333084
epsilon : 0.2200748351473355 alpha : 0.12416523075924281
epsilon : 0.13331482894782642 alpha : 0.062230028516917085
epsilon : 0.08075818212241154 alpha : 0.031188895840940083
epsilon : 0.04892091923449094 alpha : 0.015631476426409968
epsilon : 0.029634846598205228 alpha : 0.007834296427662368
epsilon : 0.017951913959130546 alpha : 0.003926449353996142
epsilon : 0.010874738754866503 alpha : 0.001967886289706926</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="31">
<pre><code>0.06320977473202194</code></pre>
</div>
</div>
<div class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1"></a>q_l <span class="op">=</span> Q_learning()</span>
<span id="cb63-2"><a href="#cb63-2"></a>π,Q<span class="op">=</span> q_l.control(s_0 <span class="op">=</span> (<span class="dv">2</span>,<span class="dv">1</span>),iter_num <span class="op">=</span> <span class="dv">10000</span>,alpha <span class="op">=</span> np.exp(np.log(<span class="fl">0.001</span>)<span class="op">/</span><span class="dv">10000</span>),epsilon <span class="op">=</span> <span class="fl">0.9995</span>)</span>
<span id="cb63-3"><a href="#cb63-3"></a>rmse <span class="op">=</span> difference(q_star,Q)</span>
<span id="cb63-4"><a href="#cb63-4"></a>np.<span class="bu">sum</span>(rmse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>epsilon : 0.9990002500000001 alpha : 0.9986194028465246
epsilon : 0.6058485196309606 alpha : 0.5004952959591761
epsilon : 0.36741975664072807 alpha : 0.25084185282524624
epsilon : 0.22282348342150354 alpha : 0.1257187342954265
epsilon : 0.13513237616300078 alpha : 0.06300862465664786
epsilon : 0.0819516812458937 alpha : 0.031579118286324974
epsilon : 0.0496999923314264 alpha : 0.015827050934311866
epsilon : 0.030140800044509277 alpha : 0.007932315874245822
epsilon : 0.0182790335512516 alpha : 0.0039755754492710235
epsilon : 0.011085408054012442 alpha : 0.0019925076614966753</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="32">
<pre><code>0.0</code></pre>
</div>
</div>
<div class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1"></a>Q</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="33">
<pre><code>{((0, 0), 'W'): 0,
 ((0, 0), 'E'): 0,
 ((0, 0), 'N'): 0,
 ((0, 0), 'S'): 0,
 ((0, 1), 'W'): -1.0,
 ((0, 1), 'E'): -3.0,
 ((0, 1), 'N'): -2.0,
 ((0, 1), 'S'): -3.0,
 ((0, 2), 'W'): -2.0,
 ((0, 2), 'E'): -4.0,
 ((0, 2), 'N'): -3.0,
 ((0, 2), 'S'): -4.0,
 ((0, 3), 'W'): -3.0,
 ((0, 3), 'E'): -4.0,
 ((0, 3), 'N'): -4.0,
 ((0, 3), 'S'): -3.0,
 ((1, 0), 'W'): -2.0,
 ((1, 0), 'E'): -3.0,
 ((1, 0), 'N'): -1.0,
 ((1, 0), 'S'): -3.0,
 ((1, 1), 'W'): -2.0,
 ((1, 1), 'E'): -4.0,
 ((1, 1), 'N'): -2.0,
 ((1, 1), 'S'): -4.0,
 ((1, 2), 'W'): -3.0,
 ((1, 2), 'E'): -3.0,
 ((1, 2), 'N'): -3.0,
 ((1, 2), 'S'): -3.0,
 ((1, 3), 'W'): -4.0,
 ((1, 3), 'E'): -3.0,
 ((1, 3), 'N'): -4.0,
 ((1, 3), 'S'): -2.0,
 ((2, 0), 'W'): -3.0,
 ((2, 0), 'E'): -4.0,
 ((2, 0), 'N'): -2.0,
 ((2, 0), 'S'): -4.0,
 ((2, 1), 'W'): -3.0,
 ((2, 1), 'E'): -3.0,
 ((2, 1), 'N'): -3.0,
 ((2, 1), 'S'): -3.0,
 ((2, 2), 'W'): -4.0,
 ((2, 2), 'E'): -2.0,
 ((2, 2), 'N'): -4.0,
 ((2, 2), 'S'): -2.0,
 ((2, 3), 'W'): -3.0,
 ((2, 3), 'E'): -2.0,
 ((2, 3), 'N'): -3.0,
 ((2, 3), 'S'): -1.0,
 ((3, 0), 'W'): -4.0,
 ((3, 0), 'E'): -3.0,
 ((3, 0), 'N'): -3.0,
 ((3, 0), 'S'): -4.0,
 ((3, 1), 'W'): -4.0,
 ((3, 1), 'E'): -2.0,
 ((3, 1), 'N'): -4.0,
 ((3, 1), 'S'): -3.0,
 ((3, 2), 'W'): -3.0,
 ((3, 2), 'E'): -1.0,
 ((3, 2), 'N'): -3.0,
 ((3, 2), 'S'): -2.0,
 ((3, 3), 'W'): 0,
 ((3, 3), 'E'): 0,
 ((3, 3), 'N'): 0,
 ((3, 3), 'S'): 0}</code></pre>
</div>
</div>
<ul>
<li>It seems to have converged very quickly and accurately!</li>
<li>Insight
<ul>
<li>Q-learning converges much faster than the SARSA algorithm.</li>
</ul></li>
</ul>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://utteranc.es/client.js" repo="hoyeon1234/sin-hoyeon" issue-term="pathname" theme="github-light" crossorigin="anonymous" async="">
</script>
</div> <!-- /content -->



</body></html>