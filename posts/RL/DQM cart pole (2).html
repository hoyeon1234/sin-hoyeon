<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.280">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>HIHO – dqm-cart-pole-(2</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-JE4129QJZV"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-JE4129QJZV', { 'anonymize_ip': true});
</script>
<meta name="google-site-verification" content="Dxb4yHeHMq4MFutu7SWlCRabUxs5bbRmpirOQOrCXRY">

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">HIHO</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html">
 <span class="menu-text">About me</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/hoyeon1234"><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#dqn-with-cartpole" id="toc-dqn-with-cartpole" class="nav-link active" data-scroll-target="#dqn-with-cartpole">DQN with CartPole</a>
  <ul class="collapse">
  <li><a href="#set-up" id="toc-set-up" class="nav-link" data-scroll-target="#set-up">Set up</a></li>
  <li><a href="#q-network" id="toc-q-network" class="nav-link" data-scroll-target="#q-network">Q-network</a></li>
  </ul></li>
  <li><a href="#코드-정리" id="toc-코드-정리" class="nav-link" data-scroll-target="#코드-정리">코드 정리</a>
  <ul class="collapse">
  <li><a href="#unpacking" id="toc-unpacking" class="nav-link" data-scroll-target="#unpacking">unpacking</a></li>
  <li><a href="#packingargs-kwargs" id="toc-packingargs-kwargs" class="nav-link" data-scroll-target="#packingargs-kwargs">packing(*args , **kwargs)</a></li>
  <li><a href="#torch.gather" id="toc-torch.gather" class="nav-link" data-scroll-target="#torch.gather">torch.gather</a></li>
  <li><a href="#map" id="toc-map" class="nav-link" data-scroll-target="#map">map()</a></li>
  <li><a href="#zip" id="toc-zip" class="nav-link" data-scroll-target="#zip">zip()</a></li>
  <li><a href="#torch.unsuqeeuze" id="toc-torch.unsuqeeuze" class="nav-link" data-scroll-target="#torch.unsuqeeuze">torch.unsuqeeuze()</a></li>
  <li><a href="#check" id="toc-check" class="nav-link" data-scroll-target="#check">check</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">



<section id="dqn-with-cartpole" class="level1">
<h1>DQN with CartPole</h1>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1"></a><span class="im">import</span> gymnasium <span class="im">as</span> gym</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="im">import</span> math</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="im">import</span> random</span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="im">import</span> matplotlib</span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="im">from</span> collections <span class="im">import</span> namedtuple, deque</span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="im">from</span> itertools <span class="im">import</span> count</span>
<span id="cb1-8"><a href="#cb1-8"></a></span>
<span id="cb1-9"><a href="#cb1-9"></a><span class="im">import</span> torch</span>
<span id="cb1-10"><a href="#cb1-10"></a><span class="im">import</span> torch.nn <span class="im">as</span> nn</span>
<span id="cb1-11"><a href="#cb1-11"></a><span class="im">import</span> torch.optim <span class="im">as</span> optim</span>
<span id="cb1-12"><a href="#cb1-12"></a><span class="im">import</span> torch.nn.functional <span class="im">as</span> F</span>
<span id="cb1-13"><a href="#cb1-13"></a></span>
<span id="cb1-14"><a href="#cb1-14"></a>env <span class="op">=</span> gym.make(<span class="st">"CartPole-v1"</span>)</span>
<span id="cb1-15"><a href="#cb1-15"></a></span>
<span id="cb1-16"><a href="#cb1-16"></a><span class="co"># set up matplotlib</span></span>
<span id="cb1-17"><a href="#cb1-17"></a>is_ipython <span class="op">=</span> <span class="st">'inline'</span> <span class="kw">in</span> matplotlib.get_backend()</span>
<span id="cb1-18"><a href="#cb1-18"></a><span class="cf">if</span> is_ipython:</span>
<span id="cb1-19"><a href="#cb1-19"></a>    <span class="im">from</span> IPython <span class="im">import</span> display</span>
<span id="cb1-20"><a href="#cb1-20"></a></span>
<span id="cb1-21"><a href="#cb1-21"></a>plt.ion()</span>
<span id="cb1-22"><a href="#cb1-22"></a></span>
<span id="cb1-23"><a href="#cb1-23"></a><span class="co"># if GPU is to be used</span></span>
<span id="cb1-24"><a href="#cb1-24"></a>device <span class="op">=</span> torch.device(<span class="st">"cuda"</span> <span class="cf">if</span> torch.cuda.is_available() <span class="cf">else</span> <span class="st">"cpu"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="set-up" class="level2">
<h2 class="anchored" data-anchor-id="set-up">Set up</h2>
<ul>
<li><span class="math inline">\(r = 1\)</span> for every incremental timestep.</li>
<li><span class="math inline">\(s_T = \text{2.4 units away from center or falls over too far}\)</span></li>
</ul>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1"></a>env <span class="op">=</span> gym.make(<span class="st">"CartPole-v1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1"></a>device <span class="op">=</span> <span class="st">"cuda"</span> <span class="cf">if</span> torch.cuda.is_available() <span class="cf">else</span> <span class="st">"cpu"</span></span>
<span id="cb3-2"><a href="#cb3-2"></a>device</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<pre><code>'cuda'</code></pre>
</div>
</div>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1"></a>Transition <span class="op">=</span> namedtuple(<span class="st">"Transition"</span>,(<span class="st">"state"</span>,<span class="st">"action"</span>,<span class="st">"next_state"</span>,<span class="st">"reward"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1"></a><span class="kw">class</span> ReplayMemory():</span>
<span id="cb6-2"><a href="#cb6-2"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>,capacity):</span>
<span id="cb6-3"><a href="#cb6-3"></a>        <span class="va">self</span>.memory <span class="op">=</span> deque([],maxlen <span class="op">=</span> capacity)</span>
<span id="cb6-4"><a href="#cb6-4"></a>    </span>
<span id="cb6-5"><a href="#cb6-5"></a>    <span class="kw">def</span> push(<span class="va">self</span>,<span class="op">*</span>args):</span>
<span id="cb6-6"><a href="#cb6-6"></a>        <span class="co">"""transition save"""</span></span>
<span id="cb6-7"><a href="#cb6-7"></a>        <span class="va">self</span>.memory.append(Transition(<span class="op">*</span>args))</span>
<span id="cb6-8"><a href="#cb6-8"></a>    </span>
<span id="cb6-9"><a href="#cb6-9"></a>    <span class="kw">def</span> sample(<span class="va">self</span>,batch_size):</span>
<span id="cb6-10"><a href="#cb6-10"></a>        <span class="co">"""</span></span>
<span id="cb6-11"><a href="#cb6-11"></a><span class="co">        Input : batch_size</span></span>
<span id="cb6-12"><a href="#cb6-12"></a><span class="co">        Output : randomly sampled transitions in memory</span></span>
<span id="cb6-13"><a href="#cb6-13"></a><span class="co">        """</span></span>
<span id="cb6-14"><a href="#cb6-14"></a>        <span class="cf">return</span> random.sample(<span class="va">self</span>.memory,batch_size)</span>
<span id="cb6-15"><a href="#cb6-15"></a>    </span>
<span id="cb6-16"><a href="#cb6-16"></a>    <span class="kw">def</span> <span class="fu">__len__</span>(<span class="va">self</span>):</span>
<span id="cb6-17"><a href="#cb6-17"></a>        <span class="cf">return</span> <span class="bu">len</span>(<span class="va">self</span>.memory)</span>
<span id="cb6-18"><a href="#cb6-18"></a>        </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="q-network" class="level2">
<h2 class="anchored" data-anchor-id="q-network">Q-network</h2>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1"></a><span class="kw">class</span> DQN(nn.Module):</span>
<span id="cb7-2"><a href="#cb7-2"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>,n_obs,n_actions):</span>
<span id="cb7-3"><a href="#cb7-3"></a>        <span class="bu">super</span>().<span class="fu">__init__</span>()</span>
<span id="cb7-4"><a href="#cb7-4"></a>        <span class="va">self</span>.layer1 <span class="op">=</span> nn.Linear(n_obs,<span class="dv">128</span>)</span>
<span id="cb7-5"><a href="#cb7-5"></a>        <span class="va">self</span>.layer2 <span class="op">=</span> nn.Linear(<span class="dv">128</span>,<span class="dv">64</span>)</span>
<span id="cb7-6"><a href="#cb7-6"></a>        <span class="va">self</span>.layer3 <span class="op">=</span> nn.Linear(<span class="dv">64</span>,n_actions)</span>
<span id="cb7-7"><a href="#cb7-7"></a>        <span class="va">self</span>.activation <span class="op">=</span> nn.ReLU()</span>
<span id="cb7-8"><a href="#cb7-8"></a>    <span class="kw">def</span> forward(<span class="va">self</span>,x):</span>
<span id="cb7-9"><a href="#cb7-9"></a>        l1_out <span class="op">=</span> <span class="va">self</span>.activation(<span class="va">self</span>.layer1(x))</span>
<span id="cb7-10"><a href="#cb7-10"></a>        l2_out <span class="op">=</span> <span class="va">self</span>.activation(<span class="va">self</span>.layer2(l1_out))</span>
<span id="cb7-11"><a href="#cb7-11"></a>        <span class="cf">return</span> <span class="va">self</span>.layer3(l2_out)</span>
<span id="cb7-12"><a href="#cb7-12"></a></span>
<span id="cb7-13"><a href="#cb7-13"></a>dqn <span class="op">=</span> DQN(<span class="dv">32</span>,<span class="dv">10</span>)</span>
<span id="cb7-14"><a href="#cb7-14"></a>_t <span class="op">=</span> torch.randn(<span class="dv">10</span>,<span class="dv">32</span>)</span>
<span id="cb7-15"><a href="#cb7-15"></a>dqn(_t)[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre><code>tensor([-0.0175, -0.0064, -0.0310,  0.0675, -0.0197,  0.2433,  0.1908, -0.0816,
        -0.0720, -0.1309], grad_fn=&lt;SelectBackward0&gt;)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1"></a><span class="co"># BATCH_SIZE is the number of transitions sampled from the replay buffer</span></span>
<span id="cb9-2"><a href="#cb9-2"></a><span class="co"># GAMMA is the discount factor as mentioned in the previous section</span></span>
<span id="cb9-3"><a href="#cb9-3"></a><span class="co"># EPS_START is the starting value of epsilon</span></span>
<span id="cb9-4"><a href="#cb9-4"></a><span class="co"># EPS_END is the final value of epsilon</span></span>
<span id="cb9-5"><a href="#cb9-5"></a><span class="co"># EPS_DECAY controls the rate of exponential decay of epsilon, higher means a slower decay</span></span>
<span id="cb9-6"><a href="#cb9-6"></a><span class="co"># TAU is the update rate of the target network</span></span>
<span id="cb9-7"><a href="#cb9-7"></a><span class="co"># LR is the learning rate of the ``AdamW`` optimizer</span></span>
<span id="cb9-8"><a href="#cb9-8"></a>BATCH_SIZE <span class="op">=</span> <span class="dv">128</span></span>
<span id="cb9-9"><a href="#cb9-9"></a>GAMMA <span class="op">=</span> <span class="fl">0.99</span></span>
<span id="cb9-10"><a href="#cb9-10"></a>EPS_START <span class="op">=</span> <span class="fl">0.9</span></span>
<span id="cb9-11"><a href="#cb9-11"></a>EPS_END <span class="op">=</span> <span class="fl">0.05</span></span>
<span id="cb9-12"><a href="#cb9-12"></a>EPS_DECAY <span class="op">=</span> <span class="dv">1000</span></span>
<span id="cb9-13"><a href="#cb9-13"></a>TAU <span class="op">=</span> <span class="fl">0.005</span></span>
<span id="cb9-14"><a href="#cb9-14"></a>LR <span class="op">=</span> <span class="fl">1e-4</span></span>
<span id="cb9-15"><a href="#cb9-15"></a></span>
<span id="cb9-16"><a href="#cb9-16"></a><span class="co"># Get number of actions from gym action space</span></span>
<span id="cb9-17"><a href="#cb9-17"></a>n_actions <span class="op">=</span> env.action_space.n</span>
<span id="cb9-18"><a href="#cb9-18"></a><span class="co"># Get the number of state observations</span></span>
<span id="cb9-19"><a href="#cb9-19"></a>state, info <span class="op">=</span> env.reset()</span>
<span id="cb9-20"><a href="#cb9-20"></a>n_observations <span class="op">=</span> <span class="bu">len</span>(state)</span>
<span id="cb9-21"><a href="#cb9-21"></a></span>
<span id="cb9-22"><a href="#cb9-22"></a>policy_net <span class="op">=</span> DQN(n_observations, n_actions).to(device)</span>
<span id="cb9-23"><a href="#cb9-23"></a>target_net <span class="op">=</span> DQN(n_observations, n_actions).to(device)</span>
<span id="cb9-24"><a href="#cb9-24"></a>target_net.load_state_dict(policy_net.state_dict())</span>
<span id="cb9-25"><a href="#cb9-25"></a></span>
<span id="cb9-26"><a href="#cb9-26"></a>optimizer <span class="op">=</span> optim.AdamW(policy_net.parameters(), lr<span class="op">=</span>LR, amsgrad<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb9-27"><a href="#cb9-27"></a>memory <span class="op">=</span> ReplayMemory(<span class="dv">10000</span>)</span>
<span id="cb9-28"><a href="#cb9-28"></a></span>
<span id="cb9-29"><a href="#cb9-29"></a></span>
<span id="cb9-30"><a href="#cb9-30"></a>steps_done <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb9-31"><a href="#cb9-31"></a></span>
<span id="cb9-32"><a href="#cb9-32"></a></span>
<span id="cb9-33"><a href="#cb9-33"></a><span class="kw">def</span> select_action(state):</span>
<span id="cb9-34"><a href="#cb9-34"></a>    <span class="kw">global</span> steps_done</span>
<span id="cb9-35"><a href="#cb9-35"></a>    sample <span class="op">=</span> random.random()</span>
<span id="cb9-36"><a href="#cb9-36"></a>    eps_threshold <span class="op">=</span> EPS_END <span class="op">+</span> (EPS_START <span class="op">-</span> EPS_END) <span class="op">*</span> <span class="op">\</span></span>
<span id="cb9-37"><a href="#cb9-37"></a>        math.exp(<span class="op">-</span><span class="fl">1.</span> <span class="op">*</span> steps_done <span class="op">/</span> EPS_DECAY)</span>
<span id="cb9-38"><a href="#cb9-38"></a>    steps_done <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb9-39"><a href="#cb9-39"></a>    <span class="cf">if</span> sample <span class="op">&gt;</span> eps_threshold:</span>
<span id="cb9-40"><a href="#cb9-40"></a>        <span class="cf">with</span> torch.no_grad():</span>
<span id="cb9-41"><a href="#cb9-41"></a>            <span class="co"># t.max(1) will return the largest column value of each row.</span></span>
<span id="cb9-42"><a href="#cb9-42"></a>            <span class="co"># second column on max result is index of where max element was</span></span>
<span id="cb9-43"><a href="#cb9-43"></a>            <span class="co"># found, so we pick action with the larger expected reward.</span></span>
<span id="cb9-44"><a href="#cb9-44"></a>            <span class="cf">return</span> policy_net(state).<span class="bu">max</span>(<span class="dv">1</span>)[<span class="dv">1</span>].view(<span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb9-45"><a href="#cb9-45"></a>    <span class="cf">else</span>:</span>
<span id="cb9-46"><a href="#cb9-46"></a>        <span class="cf">return</span> torch.tensor([[env.action_space.sample()]], device<span class="op">=</span>device, dtype<span class="op">=</span>torch.<span class="bu">long</span>)</span>
<span id="cb9-47"><a href="#cb9-47"></a></span>
<span id="cb9-48"><a href="#cb9-48"></a></span>
<span id="cb9-49"><a href="#cb9-49"></a>episode_durations <span class="op">=</span> []</span>
<span id="cb9-50"><a href="#cb9-50"></a></span>
<span id="cb9-51"><a href="#cb9-51"></a></span>
<span id="cb9-52"><a href="#cb9-52"></a><span class="kw">def</span> plot_durations(show_result<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb9-53"><a href="#cb9-53"></a>    plt.figure(<span class="dv">1</span>)</span>
<span id="cb9-54"><a href="#cb9-54"></a>    durations_t <span class="op">=</span> torch.tensor(episode_durations, dtype<span class="op">=</span>torch.<span class="bu">float</span>)</span>
<span id="cb9-55"><a href="#cb9-55"></a>    <span class="cf">if</span> show_result:</span>
<span id="cb9-56"><a href="#cb9-56"></a>        plt.title(<span class="st">'Result'</span>)</span>
<span id="cb9-57"><a href="#cb9-57"></a>    <span class="cf">else</span>:</span>
<span id="cb9-58"><a href="#cb9-58"></a>        plt.clf()</span>
<span id="cb9-59"><a href="#cb9-59"></a>        plt.title(<span class="st">'Training...'</span>)</span>
<span id="cb9-60"><a href="#cb9-60"></a>    plt.xlabel(<span class="st">'Episode'</span>)</span>
<span id="cb9-61"><a href="#cb9-61"></a>    plt.ylabel(<span class="st">'Duration'</span>)</span>
<span id="cb9-62"><a href="#cb9-62"></a>    plt.plot(durations_t.numpy())</span>
<span id="cb9-63"><a href="#cb9-63"></a>    <span class="co"># Take 100 episode averages and plot them too</span></span>
<span id="cb9-64"><a href="#cb9-64"></a>    <span class="cf">if</span> <span class="bu">len</span>(durations_t) <span class="op">&gt;=</span> <span class="dv">100</span>:</span>
<span id="cb9-65"><a href="#cb9-65"></a>        means <span class="op">=</span> durations_t.unfold(<span class="dv">0</span>, <span class="dv">100</span>, <span class="dv">1</span>).mean(<span class="dv">1</span>).view(<span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb9-66"><a href="#cb9-66"></a>        means <span class="op">=</span> torch.cat((torch.zeros(<span class="dv">99</span>), means))</span>
<span id="cb9-67"><a href="#cb9-67"></a>        plt.plot(means.numpy())</span>
<span id="cb9-68"><a href="#cb9-68"></a></span>
<span id="cb9-69"><a href="#cb9-69"></a>    plt.pause(<span class="fl">0.001</span>)  <span class="co"># pause a bit so that plots are updated</span></span>
<span id="cb9-70"><a href="#cb9-70"></a>    <span class="cf">if</span> is_ipython:</span>
<span id="cb9-71"><a href="#cb9-71"></a>        <span class="cf">if</span> <span class="kw">not</span> show_result:</span>
<span id="cb9-72"><a href="#cb9-72"></a>            display.display(plt.gcf())</span>
<span id="cb9-73"><a href="#cb9-73"></a>            display.clear_output(wait<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb9-74"><a href="#cb9-74"></a>        <span class="cf">else</span>:</span>
<span id="cb9-75"><a href="#cb9-75"></a>            display.display(plt.gcf())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1"></a>steps_done <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb10-2"><a href="#cb10-2"></a></span>
<span id="cb10-3"><a href="#cb10-3"></a><span class="kw">def</span> select_action(state):</span>
<span id="cb10-4"><a href="#cb10-4"></a>    <span class="kw">global</span> steps_done</span>
<span id="cb10-5"><a href="#cb10-5"></a>    sample <span class="op">=</span> random.random()</span>
<span id="cb10-6"><a href="#cb10-6"></a>    eps_threshold <span class="op">=</span> EPS_END <span class="op">+</span> (EPS_START <span class="op">-</span> EPS_END) <span class="op">*</span> math.exp(<span class="op">-</span><span class="dv">1</span> <span class="op">*</span> steps_done <span class="op">/</span> EPS_DECAY) <span class="co">#ϵ의 상한,하한을 만드는 전략,이거써야겠다.</span></span>
<span id="cb10-7"><a href="#cb10-7"></a>    steps_done <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb10-8"><a href="#cb10-8"></a>    <span class="co">"""</span></span>
<span id="cb10-9"><a href="#cb10-9"></a><span class="co">    if steps_done%10 == 0:</span></span>
<span id="cb10-10"><a href="#cb10-10"></a><span class="co">        print(eps_threshold,steps_done)</span></span>
<span id="cb10-11"><a href="#cb10-11"></a><span class="co">    """</span></span>
<span id="cb10-12"><a href="#cb10-12"></a>    <span class="co">#ϵ-greedy policy</span></span>
<span id="cb10-13"><a href="#cb10-13"></a>    <span class="cf">if</span> sample <span class="op">&gt;</span> eps_threshold:</span>
<span id="cb10-14"><a href="#cb10-14"></a>        <span class="cf">with</span> torch.no_grad():</span>
<span id="cb10-15"><a href="#cb10-15"></a>            <span class="cf">return</span> policy_net(state).<span class="bu">max</span>(<span class="dv">1</span>)[<span class="dv">1</span>].view(<span class="dv">1</span>,<span class="dv">1</span>)</span>
<span id="cb10-16"><a href="#cb10-16"></a>    <span class="cf">else</span>:</span>
<span id="cb10-17"><a href="#cb10-17"></a>        <span class="cf">return</span> torch.tensor([[env.action_space.sample()]],device<span class="op">=</span>device,dtype <span class="op">=</span> torch.<span class="bu">long</span>)</span>
<span id="cb10-18"><a href="#cb10-18"></a>    </span>
<span id="cb10-19"><a href="#cb10-19"></a></span>
<span id="cb10-20"><a href="#cb10-20"></a>_state <span class="op">=</span> torch.randn(<span class="dv">2</span>,<span class="dv">4</span>).to(device)</span>
<span id="cb10-21"><a href="#cb10-21"></a><span class="bu">print</span>(_state)</span>
<span id="cb10-22"><a href="#cb10-22"></a>_q_out <span class="op">=</span> policy_net(_state)</span>
<span id="cb10-23"><a href="#cb10-23"></a><span class="bu">print</span>(_q_out)</span>
<span id="cb10-24"><a href="#cb10-24"></a>_max_q <span class="op">=</span> policy_net(_state).<span class="bu">max</span>(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb10-25"><a href="#cb10-25"></a><span class="bu">print</span>(_max_q)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>tensor([[ 0.4280,  0.3374, -0.6418,  0.9572],
        [ 0.1284,  1.3429,  0.0458,  0.7359]], device='cuda:0')
tensor([[ 0.0939, -0.0166],
        [ 0.0718,  0.0492]], device='cuda:0', grad_fn=&lt;AddmmBackward0&gt;)
torch.return_types.max(
values=tensor([0.0939, 0.0718], device='cuda:0', grad_fn=&lt;MaxBackward0&gt;),
indices=tensor([0, 0], device='cuda:0'))</code></pre>
</div>
</div>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1"></a>episode_durations <span class="op">=</span> []</span>
<span id="cb12-2"><a href="#cb12-2"></a><span class="kw">def</span> plot_durations(show_result<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb12-3"><a href="#cb12-3"></a>    plt.figure(<span class="dv">1</span>)</span>
<span id="cb12-4"><a href="#cb12-4"></a>    durations_t <span class="op">=</span> torch.tensor(episode_durations, dtype<span class="op">=</span>torch.<span class="bu">float</span>)</span>
<span id="cb12-5"><a href="#cb12-5"></a>    <span class="cf">if</span> show_result:</span>
<span id="cb12-6"><a href="#cb12-6"></a>        plt.title(<span class="st">'Result'</span>)</span>
<span id="cb12-7"><a href="#cb12-7"></a>    <span class="cf">else</span>:</span>
<span id="cb12-8"><a href="#cb12-8"></a>        plt.clf()</span>
<span id="cb12-9"><a href="#cb12-9"></a>        plt.title(<span class="st">'Training...'</span>)</span>
<span id="cb12-10"><a href="#cb12-10"></a>    plt.xlabel(<span class="st">'Episode'</span>)</span>
<span id="cb12-11"><a href="#cb12-11"></a>    plt.ylabel(<span class="st">'Duration'</span>)</span>
<span id="cb12-12"><a href="#cb12-12"></a>    plt.plot(durations_t.numpy())</span>
<span id="cb12-13"><a href="#cb12-13"></a>    <span class="co"># Take 100 episode averages and plot them too</span></span>
<span id="cb12-14"><a href="#cb12-14"></a>    <span class="cf">if</span> <span class="bu">len</span>(durations_t) <span class="op">&gt;=</span> <span class="dv">100</span>:</span>
<span id="cb12-15"><a href="#cb12-15"></a>        means <span class="op">=</span> durations_t.unfold(<span class="dv">0</span>, <span class="dv">100</span>, <span class="dv">1</span>).mean(<span class="dv">1</span>).view(<span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb12-16"><a href="#cb12-16"></a>        means <span class="op">=</span> torch.cat((torch.zeros(<span class="dv">99</span>), means))</span>
<span id="cb12-17"><a href="#cb12-17"></a>        plt.plot(means.numpy())</span>
<span id="cb12-18"><a href="#cb12-18"></a></span>
<span id="cb12-19"><a href="#cb12-19"></a>    plt.pause(<span class="fl">0.001</span>)  <span class="co"># pause a bit so that plots are updated</span></span>
<span id="cb12-20"><a href="#cb12-20"></a>    <span class="cf">if</span> is_ipython:</span>
<span id="cb12-21"><a href="#cb12-21"></a>        <span class="cf">if</span> <span class="kw">not</span> show_result:</span>
<span id="cb12-22"><a href="#cb12-22"></a>            display.display(plt.gcf())</span>
<span id="cb12-23"><a href="#cb12-23"></a>            display.clear_output(wait<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb12-24"><a href="#cb12-24"></a>        <span class="cf">else</span>:</span>
<span id="cb12-25"><a href="#cb12-25"></a>            display.display(plt.gcf())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li><code>optimize_model</code> functio n
<ol type="1">
<li>samples a batch <span class="math inline">\(\sim \mathcal{D}\)</span></li>
<li>concatenate all the tensors into a single one</li>
<li>compute Q and combines them into loss</li>
<li></li>
</ol></li>
</ul>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1"></a><span class="kw">def</span> optimize_model():</span>
<span id="cb13-2"><a href="#cb13-2"></a>    <span class="cf">if</span> <span class="bu">len</span>(memory) <span class="op">&lt;</span> BATCH_SIZE:</span>
<span id="cb13-3"><a href="#cb13-3"></a>        <span class="co"># BATCH_SIZE보다 작을 경우 아예 다음 코드가 실행이 안됨.</span></span>
<span id="cb13-4"><a href="#cb13-4"></a>        <span class="co"># 즉,Experience replay가 안됨.</span></span>
<span id="cb13-5"><a href="#cb13-5"></a>        <span class="cf">return</span></span>
<span id="cb13-6"><a href="#cb13-6"></a>    <span class="kw">global</span> transitions,batch,_t,non_final_mask,non_final_next_states,state_batch<span class="op">\</span></span>
<span id="cb13-7"><a href="#cb13-7"></a>    ,reward_batch,action_batch,state_action_values,non_final_next_states,__t,before_masked,after_masked<span class="op">\</span></span>
<span id="cb13-8"><a href="#cb13-8"></a>    ,expected_state_action_values</span>
<span id="cb13-9"><a href="#cb13-9"></a>    transitions <span class="op">=</span> memory.sample(BATCH_SIZE)</span>
<span id="cb13-10"><a href="#cb13-10"></a>    <span class="co"># 메모리에서 BATCH_SIZE만큼의 Transition들을 가져옴    </span></span>
<span id="cb13-11"><a href="#cb13-11"></a>    _t <span class="op">=</span> <span class="bu">zip</span>(<span class="op">*</span>transitions)</span>
<span id="cb13-12"><a href="#cb13-12"></a>    batch <span class="op">=</span> Transition(<span class="op">*</span><span class="bu">zip</span>(<span class="op">*</span>transitions))</span>
<span id="cb13-13"><a href="#cb13-13"></a>    <span class="co"># Transition이라는 named tuple에 BATCH_SIZE만큼의 state,action ...를 따로따로 저장.</span></span>
<span id="cb13-14"><a href="#cb13-14"></a>    non_final_mask <span class="op">=</span> torch.tensor(<span class="bu">tuple</span>(<span class="bu">map</span>(<span class="kw">lambda</span> s: s <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>,</span>
<span id="cb13-15"><a href="#cb13-15"></a>                                          batch.next_state)), device<span class="op">=</span>device, dtype<span class="op">=</span>torch.<span class="bu">bool</span>)</span>
<span id="cb13-16"><a href="#cb13-16"></a>    non_final_next_states <span class="op">=</span> torch.cat([s <span class="cf">for</span> s <span class="kw">in</span> batch.next_state</span>
<span id="cb13-17"><a href="#cb13-17"></a>                                                <span class="cf">if</span> s <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>])</span>
<span id="cb13-18"><a href="#cb13-18"></a>    <span class="co"># next_state가 Terminal이 아닌 state값들만 가져옴</span></span>
<span id="cb13-19"><a href="#cb13-19"></a>    <span class="co"># Terminal이 None이므로 여기서는 None값을 제외한 next_state들을 가져옴</span></span>
<span id="cb13-20"><a href="#cb13-20"></a>    state_batch <span class="op">=</span> torch.cat(batch.state)</span>
<span id="cb13-21"><a href="#cb13-21"></a>    action_batch <span class="op">=</span> torch.cat(batch.action)</span>
<span id="cb13-22"><a href="#cb13-22"></a>    reward_batch <span class="op">=</span> torch.cat(batch.reward)</span>
<span id="cb13-23"><a href="#cb13-23"></a>    </span>
<span id="cb13-24"><a href="#cb13-24"></a>    <span class="co"># poicy_net은 현재 s_t,a_t에 대한 Q_value임.</span></span>
<span id="cb13-25"><a href="#cb13-25"></a>    <span class="co"># 일단 현재 t에 대한 Q_value를 계산!</span></span>
<span id="cb13-26"><a href="#cb13-26"></a>    <span class="co">#__t = policy_net(state_batch)</span></span>
<span id="cb13-27"><a href="#cb13-27"></a>    state_action_values <span class="op">=</span> policy_net(state_batch).gather(<span class="dv">1</span>, action_batch)</span>
<span id="cb13-28"><a href="#cb13-28"></a>    <span class="co">"""</span></span>
<span id="cb13-29"><a href="#cb13-29"></a><span class="co">    next_state_value를 계산하는 방법</span></span>
<span id="cb13-30"><a href="#cb13-30"></a><span class="co">    #1. terminal_state를 0 non_terminal_state를 1로 놓은 boolean tensor를 만든다.(mask)</span></span>
<span id="cb13-31"><a href="#cb13-31"></a><span class="co">    #2. 모든 state에 대한 value function인 target network를 가져오고</span></span>
<span id="cb13-32"><a href="#cb13-32"></a><span class="co">    #3. target network에서 mask를 활용하여 final state인 것은 value를 0으로 계산한다.</span></span>
<span id="cb13-33"><a href="#cb13-33"></a><span class="co">    # 이렇게 함으로 임의의 파라미터로 인한 target network가 Terminal state에 대한 value를 0이아닌 값을 주는 것을 막을 수 있다.</span></span>
<span id="cb13-34"><a href="#cb13-34"></a><span class="co">    """</span></span>
<span id="cb13-35"><a href="#cb13-35"></a>    next_state_values <span class="op">=</span> torch.zeros(BATCH_SIZE, device<span class="op">=</span>device)</span>
<span id="cb13-36"><a href="#cb13-36"></a>    <span class="co">#before_masked = torch.zeros(BATCH_SIZE, device=device)</span></span>
<span id="cb13-37"><a href="#cb13-37"></a>    <span class="cf">with</span> torch.no_grad():</span>
<span id="cb13-38"><a href="#cb13-38"></a>        next_state_values[non_final_mask] <span class="op">=</span> target_net(non_final_next_states).<span class="bu">max</span>(<span class="dv">1</span>)[<span class="dv">0</span>]</span>
<span id="cb13-39"><a href="#cb13-39"></a>    <span class="co"># Compute the expected Q values</span></span>
<span id="cb13-40"><a href="#cb13-40"></a>    <span class="co"># after_masked = next_state_values</span></span>
<span id="cb13-41"><a href="#cb13-41"></a>    expected_state_action_values <span class="op">=</span> (next_state_values <span class="op">*</span> GAMMA) <span class="op">+</span> reward_batch</span>
<span id="cb13-42"><a href="#cb13-42"></a></span>
<span id="cb13-43"><a href="#cb13-43"></a>    <span class="co"># Compute Huber loss</span></span>
<span id="cb13-44"><a href="#cb13-44"></a>    criterion <span class="op">=</span> nn.SmoothL1Loss()</span>
<span id="cb13-45"><a href="#cb13-45"></a>    loss <span class="op">=</span> criterion(state_action_values, expected_state_action_values.unsqueeze(<span class="dv">1</span>))</span>
<span id="cb13-46"><a href="#cb13-46"></a></span>
<span id="cb13-47"><a href="#cb13-47"></a>    <span class="co"># Optimize the model</span></span>
<span id="cb13-48"><a href="#cb13-48"></a>    optimizer.zero_grad()</span>
<span id="cb13-49"><a href="#cb13-49"></a>    loss.backward()</span>
<span id="cb13-50"><a href="#cb13-50"></a>    <span class="co"># In-place gradient clipping</span></span>
<span id="cb13-51"><a href="#cb13-51"></a>    torch.nn.utils.clip_grad_value_(policy_net.parameters(), <span class="dv">100</span>)</span>
<span id="cb13-52"><a href="#cb13-52"></a>    optimizer.step()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1"></a><span class="cf">if</span> torch.cuda.is_available():</span>
<span id="cb14-2"><a href="#cb14-2"></a>    num_episodes <span class="op">=</span> <span class="dv">500</span></span>
<span id="cb14-3"><a href="#cb14-3"></a><span class="cf">else</span>:</span>
<span id="cb14-4"><a href="#cb14-4"></a>    num_episodes <span class="op">=</span> <span class="dv">50</span></span>
<span id="cb14-5"><a href="#cb14-5"></a></span>
<span id="cb14-6"><a href="#cb14-6"></a><span class="cf">for</span> i_episode <span class="kw">in</span> <span class="bu">range</span>(num_episodes):</span>
<span id="cb14-7"><a href="#cb14-7"></a>    <span class="co"># Initialize the environment and get it's state</span></span>
<span id="cb14-8"><a href="#cb14-8"></a>    state, info <span class="op">=</span> env.reset()</span>
<span id="cb14-9"><a href="#cb14-9"></a>    state <span class="op">=</span> torch.tensor(state, dtype<span class="op">=</span>torch.float32, device<span class="op">=</span>device).unsqueeze(<span class="dv">0</span>)</span>
<span id="cb14-10"><a href="#cb14-10"></a>    <span class="cf">for</span> t <span class="kw">in</span> count():</span>
<span id="cb14-11"><a href="#cb14-11"></a>        action <span class="op">=</span> select_action(state)</span>
<span id="cb14-12"><a href="#cb14-12"></a>        observation, reward, terminated, truncated, _ <span class="op">=</span> env.step(action.item())</span>
<span id="cb14-13"><a href="#cb14-13"></a>        reward <span class="op">=</span> torch.tensor([reward], device<span class="op">=</span>device)</span>
<span id="cb14-14"><a href="#cb14-14"></a>        done <span class="op">=</span> terminated <span class="kw">or</span> truncated</span>
<span id="cb14-15"><a href="#cb14-15"></a></span>
<span id="cb14-16"><a href="#cb14-16"></a>        <span class="cf">if</span> terminated:</span>
<span id="cb14-17"><a href="#cb14-17"></a>            next_state <span class="op">=</span> <span class="va">None</span></span>
<span id="cb14-18"><a href="#cb14-18"></a>        <span class="cf">else</span>:</span>
<span id="cb14-19"><a href="#cb14-19"></a>            next_state <span class="op">=</span> torch.tensor(observation, dtype<span class="op">=</span>torch.float32, device<span class="op">=</span>device).unsqueeze(<span class="dv">0</span>)</span>
<span id="cb14-20"><a href="#cb14-20"></a></span>
<span id="cb14-21"><a href="#cb14-21"></a>        <span class="co"># Store the transition in memory</span></span>
<span id="cb14-22"><a href="#cb14-22"></a>        memory.push(state, action, next_state, reward)</span>
<span id="cb14-23"><a href="#cb14-23"></a></span>
<span id="cb14-24"><a href="#cb14-24"></a>        <span class="co"># Move to the next state</span></span>
<span id="cb14-25"><a href="#cb14-25"></a>        state <span class="op">=</span> next_state</span>
<span id="cb14-26"><a href="#cb14-26"></a></span>
<span id="cb14-27"><a href="#cb14-27"></a>        <span class="co"># Perform one step of the optimization (on the policy network)</span></span>
<span id="cb14-28"><a href="#cb14-28"></a>        optimize_model()</span>
<span id="cb14-29"><a href="#cb14-29"></a></span>
<span id="cb14-30"><a href="#cb14-30"></a>        <span class="co"># Soft update of the target network's weights</span></span>
<span id="cb14-31"><a href="#cb14-31"></a>        <span class="co"># θ′ ← τ θ + (1 −τ )θ′</span></span>
<span id="cb14-32"><a href="#cb14-32"></a>        target_net_state_dict <span class="op">=</span> target_net.state_dict()</span>
<span id="cb14-33"><a href="#cb14-33"></a>        policy_net_state_dict <span class="op">=</span> policy_net.state_dict()</span>
<span id="cb14-34"><a href="#cb14-34"></a>        <span class="cf">for</span> key <span class="kw">in</span> policy_net_state_dict:</span>
<span id="cb14-35"><a href="#cb14-35"></a>            target_net_state_dict[key] <span class="op">=</span> policy_net_state_dict[key]<span class="op">*</span>TAU <span class="op">+</span> target_net_state_dict[key]<span class="op">*</span>(<span class="dv">1</span><span class="op">-</span>TAU)</span>
<span id="cb14-36"><a href="#cb14-36"></a>        target_net.load_state_dict(target_net_state_dict)</span>
<span id="cb14-37"><a href="#cb14-37"></a></span>
<span id="cb14-38"><a href="#cb14-38"></a>        <span class="cf">if</span> done:</span>
<span id="cb14-39"><a href="#cb14-39"></a>            episode_durations.append(t <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb14-40"><a href="#cb14-40"></a>            plot_durations()</span>
<span id="cb14-41"><a href="#cb14-41"></a>            <span class="cf">break</span></span>
<span id="cb14-42"><a href="#cb14-42"></a></span>
<span id="cb14-43"><a href="#cb14-43"></a><span class="bu">print</span>(<span class="st">'Complete'</span>)</span>
<span id="cb14-44"><a href="#cb14-44"></a>plot_durations(show_result<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb14-45"><a href="#cb14-45"></a>plt.ioff()</span>
<span id="cb14-46"><a href="#cb14-46"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Complete</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="DQM cart pole (2)_files/figure-html/cell-12-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Figure size 640x480 with 0 Axes&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Figure size 640x480 with 0 Axes&gt;</code></pre>
</div>
</div>
<div class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1"></a>s,_ <span class="op">=</span> env.reset()</span>
<span id="cb18-2"><a href="#cb18-2"></a>policy_net(torch.tensor(s).to(device))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="42">
<pre><code>tensor([99.5481, 99.2072], device='cuda:0', grad_fn=&lt;AddBackward0&gt;)</code></pre>
</div>
</div>
</section>
</section>
<section id="코드-정리" class="level1">
<h1>코드 정리</h1>
<section id="unpacking" class="level2">
<h2 class="anchored" data-anchor-id="unpacking">unpacking</h2>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1"></a><span class="kw">def</span> intro(name,age,univeristy_department):</span>
<span id="cb20-2"><a href="#cb20-2"></a>    <span class="bu">print</span>(name,age,univeristy_department)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1"></a>info <span class="op">=</span> [<span class="st">"신호연"</span>,<span class="dv">14</span>,[<span class="st">"HY"</span>,<span class="st">"AI-semiconductor"</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1"></a>intro(info)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>TypeError: intro() missing 2 required positional arguments: 'age' and 'univeristy_department'</code></pre>
</div>
</div>
<ul>
<li>함수는 3개의 파라미터에 대한 값(인자)를 필요로하는데 넣어주는 건 하나여서 오류 발생</li>
<li>리스트의 3개의 요소가 각각의 파라미터에 들어가는 인자가 되어야 함.</li>
<li>이때 unpacking, 즉 iterable한 객체안에 있는 요소를 input으로 넣어주는 역할</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1"></a>intro(<span class="op">*</span>info)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>신호연 14 ['HY', 'AI-semiconductor']</code></pre>
</div>
</div>
</section>
<section id="packingargs-kwargs" class="level2">
<h2 class="anchored" data-anchor-id="packingargs-kwargs">packing(*args , **kwargs)</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1"></a><span class="kw">def</span> hello(<span class="op">*</span>args):</span>
<span id="cb26-2"><a href="#cb26-2"></a>    <span class="bu">print</span>(args)</span>
<span id="cb26-3"><a href="#cb26-3"></a>hello(<span class="dv">1</span>,<span class="fl">2.5</span>,<span class="st">"hi"</span>,<span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(1, 2.5, 'hi', True)</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1"></a><span class="kw">def</span> hello(<span class="op">**</span>kwargs):</span>
<span id="cb28-2"><a href="#cb28-2"></a>    <span class="bu">print</span>(kwargs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1"></a>hello(kwargs1 <span class="op">=</span> <span class="st">"g"</span>,kw <span class="op">=</span> <span class="dv">2</span>,age <span class="op">=</span> <span class="dv">26</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{'kwargs1': 'g', 'kw': 2, 'age': 26}</code></pre>
</div>
</div>
</section>
<section id="torch.gather" class="level2">
<h2 class="anchored" data-anchor-id="torch.gather">torch.gather</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1"></a>t <span class="op">=</span> torch.tensor([i<span class="op">+</span><span class="dv">1</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">9</span>)]).reshape(<span class="dv">3</span>,<span class="dv">3</span>)</span>
<span id="cb31-2"><a href="#cb31-2"></a>index <span class="op">=</span> torch.tensor([[<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>],[<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">0</span>]])</span>
<span id="cb31-3"><a href="#cb31-3"></a>torch.gather(t,dim<span class="op">=</span><span class="dv">0</span>,index<span class="op">=</span>index)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<pre><code>tensor([[1, 5, 9],
        [4, 8, 3]])</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1"></a>t</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<pre><code>tensor([[1, 2, 3],
        [4, 5, 6],
        [7, 8, 9]])</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1"></a>t <span class="op">=</span> torch.tensor([i<span class="op">+</span><span class="dv">1</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">9</span>)]).reshape(<span class="dv">3</span>,<span class="dv">3</span>)</span>
<span id="cb35-2"><a href="#cb35-2"></a>index <span class="op">=</span> torch.tensor([[<span class="dv">0</span>,<span class="dv">1</span>],[<span class="dv">1</span>,<span class="dv">2</span>]])</span>
<span id="cb35-3"><a href="#cb35-3"></a>torch.gather(t,dim<span class="op">=</span><span class="dv">1</span>,index<span class="op">=</span>index)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="30">
<pre><code>tensor([[1, 2],
        [5, 6]])</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1"></a>[[<span class="dv">1</span>,<span class="dv">2</span>,]</span>
<span id="cb37-2"><a href="#cb37-2"></a>,[<span class="dv">5</span>,<span class="dv">6</span>]</span>
<span id="cb37-3"><a href="#cb37-3"></a>,[<span class="dv">9</span>,<span class="dv">7</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre><code>[[1, 2], [5, 6], [9, 7]]</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1"></a>torch.gather(t,dim<span class="op">=</span><span class="dv">1</span>,index<span class="op">=</span>torch.tensor([[<span class="dv">1</span>,<span class="dv">1</span>]]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="33">
<pre><code>tensor([[2, 2]])</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1"></a>t <span class="op">=</span> torch.tensor([i <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">100</span>)]).reshape(<span class="dv">10</span>,<span class="dv">10</span>)</span>
<span id="cb41-2"><a href="#cb41-2"></a>index <span class="op">=</span> torch.tensor([i <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">10</span>)]<span class="op">*</span><span class="dv">2</span>).reshape(<span class="dv">10</span>,<span class="dv">2</span>)[:<span class="op">-</span><span class="dv">3</span>]</span>
<span id="cb41-3"><a href="#cb41-3"></a>g_t <span class="op">=</span> torch.gather(t,<span class="dv">1</span>,index)</span>
<span id="cb41-4"><a href="#cb41-4"></a><span class="bu">print</span>(t.shape,index.shape)</span>
<span id="cb41-5"><a href="#cb41-5"></a><span class="bu">print</span>(g_t)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>torch.Size([10, 10]) torch.Size([7, 2])
tensor([[ 0,  1],
        [12, 13],
        [24, 25],
        [36, 37],
        [48, 49],
        [50, 51],
        [62, 63]])</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1"></a>A <span class="op">=</span> torch.tensor([i<span class="op">+</span><span class="dv">1</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">4</span>)]).reshape(<span class="dv">2</span>,<span class="dv">2</span>)</span>
<span id="cb43-2"><a href="#cb43-2"></a>torch.gather(A,index<span class="op">=</span>index,dim<span class="op">=</span><span class="dv">1</span>).reshape(<span class="dv">1</span>,<span class="dv">2</span>)</span>
<span id="cb43-3"><a href="#cb43-3"></a>index <span class="op">=</span> torch.tensor([[<span class="dv">0</span>],[<span class="dv">1</span>]])</span>
<span id="cb43-4"><a href="#cb43-4"></a>A.dim(),index.dim(),index,A.shape,index.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="108">
<pre><code>(2,
 2,
 tensor([[0],
         [1]]),
 torch.Size([2, 2]),
 torch.Size([2, 1]))</code></pre>
</div>
</div>
</section>
<section id="map" class="level2">
<h2 class="anchored" data-anchor-id="map">map()</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1"></a><span class="co"># 리스트에 값을 하나씩 더해서 새로운 리스트를 만드는 작업</span></span>
<span id="cb45-2"><a href="#cb45-2"></a>myList <span class="op">=</span> [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>]</span>
<span id="cb45-3"><a href="#cb45-3"></a></span>
<span id="cb45-4"><a href="#cb45-4"></a><span class="co"># for 반복문 이용</span></span>
<span id="cb45-5"><a href="#cb45-5"></a>result1 <span class="op">=</span> []</span>
<span id="cb45-6"><a href="#cb45-6"></a><span class="cf">for</span> val <span class="kw">in</span> myList:</span>
<span id="cb45-7"><a href="#cb45-7"></a>    result1.append(val <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb45-8"><a href="#cb45-8"></a></span>
<span id="cb45-9"><a href="#cb45-9"></a><span class="bu">print</span>(<span class="ss">f'result1 : </span><span class="sc">{</span>result1<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb45-10"><a href="#cb45-10"></a></span>
<span id="cb45-11"><a href="#cb45-11"></a></span>
<span id="cb45-12"><a href="#cb45-12"></a><span class="co"># map 함수 이용</span></span>
<span id="cb45-13"><a href="#cb45-13"></a><span class="kw">def</span> add_one(n):</span>
<span id="cb45-14"><a href="#cb45-14"></a>    <span class="cf">return</span> n <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb45-15"><a href="#cb45-15"></a></span>
<span id="cb45-16"><a href="#cb45-16"></a></span>
<span id="cb45-17"><a href="#cb45-17"></a>result2 <span class="op">=</span> <span class="bu">list</span>(<span class="bu">map</span>(add_one, myList))  <span class="co"># map반환을 list 로 변환</span></span>
<span id="cb45-18"><a href="#cb45-18"></a><span class="bu">print</span>(<span class="ss">f'result2 : </span><span class="sc">{</span>result2<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>result1 : [2, 3, 4, 5, 6]
result2 : [2, 3, 4, 5, 6]</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1"></a>myList</span>
<span id="cb47-2"><a href="#cb47-2"></a></span>
<span id="cb47-3"><a href="#cb47-3"></a>result1 <span class="op">=</span> []</span>
<span id="cb47-4"><a href="#cb47-4"></a><span class="cf">for</span> val <span class="kw">in</span> myList:</span>
<span id="cb47-5"><a href="#cb47-5"></a>    result1.append(val<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb47-6"><a href="#cb47-6"></a><span class="bu">print</span>(result1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[2, 3, 4, 5, 6]</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1"></a>result2 <span class="op">=</span> <span class="bu">list</span>(<span class="bu">map</span>(<span class="kw">lambda</span> x : x<span class="op">+</span><span class="dv">1</span>,myList))</span>
<span id="cb49-2"><a href="#cb49-2"></a>result2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="243">
<pre><code>[2, 3, 4, 5, 6]</code></pre>
</div>
</div>
</section>
<section id="zip" class="level2">
<h2 class="anchored" data-anchor-id="zip">zip()</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1"></a>a <span class="op">=</span> [<span class="st">"1"</span>,<span class="dv">2</span>]</span>
<span id="cb51-2"><a href="#cb51-2"></a>b <span class="op">=</span> [<span class="dv">3</span>,<span class="st">"5"</span>]</span>
<span id="cb51-3"><a href="#cb51-3"></a>c <span class="op">=</span> [<span class="dv">2</span>,<span class="dv">4</span>]</span>
<span id="cb51-4"><a href="#cb51-4"></a><span class="cf">for</span> t <span class="kw">in</span> <span class="bu">zip</span>(a,b,c):</span>
<span id="cb51-5"><a href="#cb51-5"></a>    <span class="bu">print</span>(t)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>('1', 3, 2)
(2, '5', 4)</code></pre>
</div>
</div>
</section>
<section id="torch.unsuqeeuze" class="level2">
<h2 class="anchored" data-anchor-id="torch.unsuqeeuze">torch.unsuqeeuze()</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1"></a><span class="im">import</span> torch</span>
<span id="cb53-2"><a href="#cb53-2"></a>ind_A  <span class="op">=</span> torch.tensor([<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">3</span>])</span>
<span id="cb53-3"><a href="#cb53-3"></a>ind_A.unsqueeze(<span class="dv">1</span>).unsqueeze(<span class="dv">1</span>) <span class="op">==</span> ind_A.unsqueeze(<span class="dv">1</span>).unsqueeze(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="29">
<pre><code>tensor([[[True]],

        [[True]],

        [[True]]])</code></pre>
</div>
</div>
<div class="cell" data-scrolled="true">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1"></a>torch.tensor([i <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">8</span>)]).reshape(<span class="dv">2</span>,<span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="42">
<pre><code>tensor([[0, 1, 2, 3],
        [4, 5, 6, 7]])</code></pre>
</div>
</div>
</section>
<section id="check" class="level2">
<h2 class="anchored" data-anchor-id="check">check</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1"></a><span class="bu">len</span>(transitions)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>128</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1"></a>before_masked</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>tensor([0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
        0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
        0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
        0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
        0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
        0., 0., 0., 0., 0., 0., 0., 0.], device='cuda:0')</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1"></a>after_masked</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>tensor([0.4509, 0.6724, 0.6550, 0.3936, 0.4086, 0.3233, 0.3974, 0.6300, 0.0000,
        0.3620, 1.1384, 0.3229, 0.4893, 0.9286, 0.3843, 0.4094, 0.3200, 0.6750,
        0.3486, 0.4730, 0.7877, 0.5478, 0.3448, 0.0000, 0.5176, 0.3613, 0.3535,
        0.3946, 0.8328, 0.3183, 0.4061, 0.3919, 0.3045, 0.3789, 0.7998, 0.8365,
        0.9102, 0.3106, 0.3463, 0.4299, 0.3520, 0.6124, 0.3324, 0.6185, 0.4004,
        0.3432, 0.6711, 0.3977, 0.3285, 0.6386, 0.3412, 0.7142, 0.5016, 0.3459,
        0.0000, 0.3325, 0.3951, 0.3529, 0.4550, 0.5403, 0.3315, 0.3641, 0.3638,
        0.6286, 0.3520, 0.4379, 0.3301, 0.7780, 0.3207, 0.4688, 0.0000, 0.4506,
        0.3452, 0.4396, 0.6683, 0.3663, 0.8068, 0.8672, 0.6586, 0.3427, 0.4015,
        0.3412, 0.6464, 0.8239, 0.3989, 0.3136, 1.3251, 0.5879, 0.3562, 0.3875,
        0.4905, 0.3174, 0.3465, 0.3737, 1.2304, 0.4512, 0.3386, 0.7941, 0.3301,
        0.3950, 0.3471, 0.3744, 1.0437, 0.3394, 0.3246, 0.5522, 0.3403, 0.4993,
        0.4461, 0.5644, 0.6235, 0.4678, 0.7648, 0.3878, 0.3846, 0.4321, 1.1868,
        0.3423, 0.4125, 0.3476, 0.6812, 0.0000, 0.6112, 0.5141, 0.3533, 0.3334,
        0.3472, 0.2959], device='cuda:0')</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1"></a>t <span class="op">=</span> Transition(<span class="op">*</span><span class="bu">zip</span>(<span class="op">*</span>transitions))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1"></a>t.next_state</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>(tensor([[ 0.1073,  1.7679, -0.1467, -2.5517]], device='cuda:0'),
 tensor([[ 0.0853,  1.2131, -0.1016, -1.8380]], device='cuda:0'),
 tensor([[-0.0783,  0.5542,  0.1493, -0.4089]], device='cuda:0'),
 tensor([[ 0.3524,  1.9037, -0.1091, -2.0654]], device='cuda:0'),
 tensor([[ 0.0199,  0.1916, -0.0173, -0.3075]], device='cuda:0'),
 tensor([[-0.0198,  0.4050,  0.0023, -0.5490]], device='cuda:0'),
 tensor([[ 0.0097,  0.3763,  0.0113, -0.3715]], device='cuda:0'),
 tensor([[-0.0265,  0.5466,  0.1104, -0.2387]], device='cuda:0'),
 tensor([[ 0.0936,  1.0071, -0.1436, -1.5632]], device='cuda:0'),
 tensor([[ 0.0229,  0.4268, -0.0829, -0.7092]], device='cuda:0'),
 tensor([[-0.0352, -0.0211, -0.0086, -0.0348]], device='cuda:0'),
 tensor([[ 0.0347,  0.6346, -0.1449, -1.1158]], device='cuda:0'),
 tensor([[ 0.1541,  0.8217, -0.1321, -1.1422]], device='cuda:0'),
 tensor([[ 0.1673,  1.3828, -0.1596, -2.1547]], device='cuda:0'),
 tensor([[-0.0433,  0.4303, -0.0228, -0.6093]], device='cuda:0'),
 tensor([[-0.0285,  0.5732,  0.0584, -0.7044]], device='cuda:0'),
 tensor([[-0.0856,  0.3615,  0.1526, -0.1680]], device='cuda:0'),
 tensor([[ 0.2314,  1.5120,  0.0065, -1.4392]], device='cuda:0'),
 tensor([[ 0.0240, -0.1551, -0.0162,  0.2688]], device='cuda:0'),
 tensor([[ 0.0085,  0.0406,  0.0099, -0.0364]], device='cuda:0'),
 tensor([[-0.0609,  0.1449,  0.1419, -0.0150]], device='cuda:0'),
 tensor([[-0.0229,  0.7601, -0.0386, -1.2230]], device='cuda:0'),
 tensor([[ 0.0440,  0.9616, -0.0284, -1.2477]], device='cuda:0'),
 tensor([[-0.0254, -0.0371,  0.1096,  0.2920]], device='cuda:0'),
 tensor([[ 0.0575,  0.5710, -0.0283, -0.8761]], device='cuda:0'),
 None,
 tensor([[-0.0227, -0.2063,  0.0239,  0.3246]], device='cuda:0'),
 tensor([[-0.0155, -0.5877,  0.0317,  0.8373]], device='cuda:0'),
 tensor([[ 0.2050,  1.3173,  0.0296, -1.1560]], device='cuda:0'),
 tensor([[-1.4073e-02, -3.7479e-01,  2.4043e-04,  6.0724e-01]], device='cuda:0'),
 tensor([[ 0.0105,  1.1017,  0.1021, -1.0711]], device='cuda:0'),
 tensor([[-0.0261, -0.2336,  0.1154,  0.6171]], device='cuda:0'),
 tensor([[ 6.1860e-04, -6.2460e-01,  4.1290e-02,  9.1309e-01]], device='cuda:0'),
 tensor([[ 0.0380, -0.0239,  0.0852,  0.3501]], device='cuda:0'),
 tensor([[ 0.0263, -0.1556, -0.0214,  0.2805]], device='cuda:0'),
 tensor([[-0.0045,  0.0275, -0.0069,  0.0019]], device='cuda:0'),
 tensor([[ 0.0352, -0.2067,  0.0393,  0.3709]], device='cuda:0'),
 tensor([[ 0.0520,  0.8176,  0.0014, -1.0424]], device='cuda:0'),
 tensor([[ 0.0507,  0.7092,  0.0657, -0.4313]], device='cuda:0'),
 tensor([[ 0.0496,  0.2426, -0.0386, -0.2745]], device='cuda:0'),
 tensor([[ 0.0365, -0.0180,  0.0587,  0.2197]], device='cuda:0'),
 tensor([[-0.0416,  0.3695, -0.0076, -0.6290]], device='cuda:0'),
 tensor([[-0.0201, -0.0344,  0.0939,  0.2313]], device='cuda:0'),
 tensor([[ 0.0504,  0.5380,  0.0743, -0.0478]], device='cuda:0'),
 tensor([[-0.0088,  0.4327, -0.0728, -0.6648]], device='cuda:0'),
 tensor([[-0.0349,  0.2070,  0.0439, -0.1921]], device='cuda:0'),
 tensor([[-0.0885, -0.0239,  0.1448,  0.3172]], device='cuda:0'),
 tensor([[-0.0222,  0.4311, -0.0532, -0.6276]], device='cuda:0'),
 tensor([[ 0.3219,  1.5108, -0.1147, -1.4554]], device='cuda:0'),
 tensor([[ 0.0611,  0.7320,  0.0734, -0.3161]], device='cuda:0'),
 tensor([[ 0.1906,  1.3128, -0.0039, -1.0927]], device='cuda:0'),
 tensor([[-0.0327, -0.1801,  0.0309,  0.3245]], device='cuda:0'),
 tensor([[-0.0105, -0.1798, -0.0061,  0.3165]], device='cuda:0'),
 tensor([[ 0.0474,  0.8313, -0.1672, -1.4501]], device='cuda:0'),
 tensor([[ 0.0024,  0.7370,  0.1039, -0.4280]], device='cuda:0'),
 tensor([[-2.4166e-04, -2.2275e-01,  5.1142e-02,  3.7374e-01]], device='cuda:0'),
 tensor([[-0.0464, -0.4346,  0.1129,  0.7364]], device='cuda:0'),
 tensor([[ 0.0681,  0.4396, -0.0616, -0.6103]], device='cuda:0'),
 tensor([[-0.0073,  0.0277, -0.0010, -0.0024]], device='cuda:0'),
 tensor([[ 0.2655,  1.5088, -0.0638, -1.4074]], device='cuda:0'),
 tensor([[-0.0523,  0.5501,  0.1281, -0.3174]], device='cuda:0'),
 tensor([[-0.0268, -0.4017,  0.0304,  0.6248]], device='cuda:0'),
 tensor([[-0.0252, -0.3750,  0.0187,  0.6112]], device='cuda:0'),
 tensor([[ 0.0380,  1.1537, -0.1385, -1.8957]], device='cuda:0'),
 tensor([[ 0.0393, -0.2157,  0.0672,  0.5696]], device='cuda:0'),
 tensor([[ 0.0603,  1.0157, -0.1446, -1.6753]], device='cuda:0'),
 tensor([[-0.0318,  0.0135,  0.0334,  0.0655]], device='cuda:0'),
 tensor([[-0.0342, -0.4375,  0.1618,  1.1126]], device='cuda:0'),
 None,
 tensor([[ 0.1095,  1.4092, -0.1383, -2.1604]], device='cuda:0'),
 tensor([[-0.0315, -0.1821,  0.0348,  0.3686]], device='cuda:0'),
 tensor([[-0.0208, -0.2307,  0.0986,  0.5520]], device='cuda:0'),
 tensor([[-0.0017,  0.5718,  0.0247, -0.6719]], device='cuda:0'),
 tensor([[-0.0562,  0.3336,  0.1494, -0.1687]], device='cuda:0'),
 None,
 tensor([[ 0.0361,  0.1762,  0.0631, -0.0539]], device='cuda:0'),
 tensor([[ 0.1826,  1.1228,  0.0472, -0.8785]], device='cuda:0'),
 tensor([[-0.0495,  0.5263,  0.1460, -0.4107]], device='cuda:0'),
 tensor([[-0.0108,  0.0153, -0.0066,  0.0259]], device='cuda:0'),
 tensor([[ 0.1062,  0.6378, -0.1170, -0.9742]], device='cuda:0'),
 tensor([[ 0.1377,  1.6054, -0.1815, -2.4924]], device='cuda:0'),
 tensor([[-0.0216, -0.1797,  0.0124,  0.3146]], device='cuda:0'),
 tensor([[-0.0243,  0.0150,  0.0069,  0.0318]], device='cuda:0'),
 tensor([[ 0.0092, -0.4291,  0.0291,  0.6114]], device='cuda:0'),
 tensor([[ 0.0806,  0.8225, -0.1781, -1.4309]], device='cuda:0'),
 tensor([[-0.0387,  0.1740, -0.0020, -0.3269]], device='cuda:0'),
 tensor([[-0.0795, -0.2135,  0.1191,  0.4876]], device='cuda:0'),
 tensor([[-4.4667e-02, -2.0743e-02,  2.7441e-05, -4.3369e-02]], device='cuda:0'),
 tensor([[ 0.0544,  0.4382, -0.0440, -0.5791]], device='cuda:0'),
 tensor([[ 0.0829,  1.0977,  0.0431, -0.9767]], device='cuda:0'),
 tensor([[ 0.1300,  1.0108, -0.2012, -1.6604]], device='cuda:0'),
 tensor([[-0.0119, -0.4301,  0.0596,  0.6337]], device='cuda:0'),
 tensor([[ 0.1379,  0.5778, -0.1564, -1.0362]], device='cuda:0'),
 tensor([[-0.0108,  0.7907,  0.0156, -1.0333]], device='cuda:0'),
 tensor([[ 0.0209,  0.0403, -0.0108, -0.0289]], device='cuda:0'),
 tensor([[-0.0580, -0.0520,  0.1416,  0.3188]], device='cuda:0'),
 tensor([[-0.0033,  0.0339, -0.0412, -0.0622]], device='cuda:0'),
 tensor([[ 0.0349, -0.0216,  0.0786,  0.2988]], device='cuda:0'),
 tensor([[ 0.0716,  0.5464,  0.1139, -0.1981]], device='cuda:0'),
 tensor([[ 0.2168,  1.1177, -0.0258, -0.8012]], device='cuda:0'),
 tensor([[-0.0316,  0.1528,  0.1350,  0.1131]], device='cuda:0'),
 tensor([[ 0.1949,  1.5791, -0.2027, -2.4921]], device='cuda:0'),
 tensor([[ 0.0407, -0.2124,  0.0488,  0.4966]], device='cuda:0'),
 tensor([[-0.0053, -0.2243,  0.0606,  0.4082]], device='cuda:0'),
 tensor([[-0.0072, -0.1800, -0.0131,  0.3227]], device='cuda:0'),
 tensor([[ 0.0197, -0.3928, -0.0185,  0.5500]], device='cuda:0'),
 tensor([[ 0.4324,  2.2959, -0.1982, -2.7246]], device='cuda:0'),
 tensor([[-0.0671, -0.2107,  0.0957,  0.4245]], device='cuda:0'),
 tensor([[ 0.2392,  1.3132, -0.0418, -1.1019]], device='cuda:0'),
 tensor([[ 0.0524,  0.5993,  0.0138, -0.8970]], device='cuda:0'),
 tensor([[ 0.1049,  0.6233, -0.0671, -0.7702]], device='cuda:0'),
 tensor([[-0.0273, -0.3930,  0.0485,  0.5547]], device='cuda:0'),
 tensor([[ 0.0232,  0.0398, -0.0158, -0.0188]], device='cuda:0'),
 tensor([[ 0.0611,  0.9604, -0.1764, -1.6490]], device='cuda:0'),
 tensor([[-0.0399, -0.0209, -0.0042, -0.0405]], device='cuda:0'),
 tensor([[ 0.2074,  1.0223, -0.2091, -1.5771]], device='cuda:0'),
 tensor([[ 0.0232,  0.3763,  0.0245, -0.5937]], device='cuda:0'),
 tensor([[ 0.1303,  0.3810, -0.1424, -0.7023]], device='cuda:0'),
 tensor([[ 0.0758,  1.5720, -0.1021, -2.2294]], device='cuda:0'),
 tensor([[-0.0078,  0.2285, -0.0344, -0.3439]], device='cuda:0'),
 tensor([[ 0.0289,  0.6130, -0.0475, -0.8798]], device='cuda:0'),
 tensor([[ 0.0127,  0.8078, -0.0242, -1.1648]], device='cuda:0'),
 tensor([[-0.0131,  0.2277, -0.0270, -0.3248]], device='cuda:0'),
 tensor([[ 0.0263,  0.2333,  0.0297, -0.1874]], device='cuda:0'),
 tensor([[ 0.0900,  0.7685, -0.0864, -1.0032]], device='cuda:0'),
 tensor([[ 0.1479,  0.9677, -0.1658, -1.3973]], device='cuda:0'),
 tensor([[ 0.1426,  1.9639, -0.1978, -2.8855]], device='cuda:0'),
 tensor([[ 0.0401,  0.2099,  0.0327, -0.3305]], device='cuda:0'))</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1"></a>non_final_mask</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>tensor([ True,  True,  True,  True,  True,  True,  True,  True,  True,  True,
         True,  True,  True,  True,  True,  True,  True,  True,  True,  True,
         True,  True,  True,  True,  True, False,  True,  True,  True,  True,
         True,  True,  True,  True,  True,  True,  True,  True,  True,  True,
         True,  True,  True,  True,  True,  True,  True,  True,  True,  True,
         True,  True,  True,  True,  True,  True,  True,  True,  True,  True,
         True,  True,  True,  True,  True,  True,  True,  True, False,  True,
         True,  True,  True,  True, False,  True,  True,  True,  True,  True,
         True,  True,  True,  True,  True,  True,  True,  True,  True,  True,
         True,  True,  True,  True,  True,  True,  True,  True,  True,  True,
         True,  True,  True,  True,  True,  True,  True,  True,  True,  True,
         True,  True,  True,  True,  True,  True,  True,  True,  True,  True,
         True,  True,  True,  True,  True,  True,  True,  True],
       device='cuda:0')</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1"></a>non_final_next_states</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>tensor([[ 1.0728e-01,  1.7679e+00, -1.4673e-01, -2.5517e+00],
        [ 8.5259e-02,  1.2131e+00, -1.0157e-01, -1.8380e+00],
        [-7.8343e-02,  5.5417e-01,  1.4926e-01, -4.0886e-01],
        [ 3.5235e-01,  1.9037e+00, -1.0908e-01, -2.0654e+00],
        [ 1.9913e-02,  1.9158e-01, -1.7274e-02, -3.0751e-01],
        [-1.9780e-02,  4.0505e-01,  2.3448e-03, -5.4902e-01],
        [ 9.7404e-03,  3.7633e-01,  1.1278e-02, -3.7153e-01],
        [-2.6455e-02,  5.4661e-01,  1.1037e-01, -2.3874e-01],
        [ 9.3618e-02,  1.0071e+00, -1.4358e-01, -1.5632e+00],
        [ 2.2926e-02,  4.2684e-01, -8.2918e-02, -7.0916e-01],
        [-3.5185e-02, -2.1130e-02, -8.5862e-03, -3.4842e-02],
        [ 3.4693e-02,  6.3463e-01, -1.4485e-01, -1.1158e+00],
        [ 1.5410e-01,  8.2174e-01, -1.3214e-01, -1.1422e+00],
        [ 1.6725e-01,  1.3828e+00, -1.5965e-01, -2.1547e+00],
        [-4.3299e-02,  4.3027e-01, -2.2846e-02, -6.0928e-01],
        [-2.8509e-02,  5.7321e-01,  5.8367e-02, -7.0439e-01],
        [-8.5573e-02,  3.6152e-01,  1.5262e-01, -1.6795e-01],
        [ 2.3138e-01,  1.5120e+00,  6.4903e-03, -1.4392e+00],
        [ 2.3984e-02, -1.5510e-01, -1.6168e-02,  2.6882e-01],
        [ 8.5098e-03,  4.0588e-02,  9.9209e-03, -3.6359e-02],
        [-6.0870e-02,  1.4486e-01,  1.4186e-01, -1.5038e-02],
        [-2.2909e-02,  7.6013e-01, -3.8622e-02, -1.2230e+00],
        [ 4.4020e-02,  9.6161e-01, -2.8407e-02, -1.2477e+00],
        [-2.5384e-02, -3.7131e-02,  1.0959e-01,  2.9197e-01],
        [ 5.7491e-02,  5.7101e-01, -2.8258e-02, -8.7609e-01],
        [-2.2680e-02, -2.0627e-01,  2.3863e-02,  3.2464e-01],
        [-1.5548e-02, -5.8772e-01,  3.1742e-02,  8.3726e-01],
        [ 2.0503e-01,  1.3173e+00,  2.9610e-02, -1.1560e+00],
        [-1.4073e-02, -3.7479e-01,  2.4043e-04,  6.0724e-01],
        [ 1.0511e-02,  1.1017e+00,  1.0213e-01, -1.0711e+00],
        [-2.6127e-02, -2.3363e-01,  1.1543e-01,  6.1711e-01],
        [ 6.1860e-04, -6.2460e-01,  4.1290e-02,  9.1309e-01],
        [ 3.7959e-02, -2.3878e-02,  8.5210e-02,  3.5006e-01],
        [ 2.6300e-02, -1.5563e-01, -2.1402e-02,  2.8052e-01],
        [-4.4911e-03,  2.7487e-02, -6.8719e-03,  1.8818e-03],
        [ 3.5180e-02, -2.0672e-01,  3.9325e-02,  3.7091e-01],
        [ 5.1980e-02,  8.1759e-01,  1.4439e-03, -1.0424e+00],
        [ 5.0652e-02,  7.0924e-01,  6.5745e-02, -4.3127e-01],
        [ 4.9577e-02,  2.4258e-01, -3.8557e-02, -2.7447e-01],
        [ 3.6487e-02, -1.8007e-02,  5.8725e-02,  2.1971e-01],
        [-4.1594e-02,  3.6951e-01, -7.5608e-03, -6.2899e-01],
        [-2.0081e-02, -3.4411e-02,  9.3927e-02,  2.3128e-01],
        [ 5.0384e-02,  5.3801e-01,  7.4328e-02, -4.7782e-02],
        [-8.8230e-03,  4.3273e-01, -7.2807e-02, -6.6481e-01],
        [-3.4912e-02,  2.0700e-01,  4.3867e-02, -1.9207e-01],
        [-8.8472e-02, -2.3938e-02,  1.4481e-01,  3.1723e-01],
        [-2.2179e-02,  4.3108e-01, -5.3213e-02, -6.2760e-01],
        [ 3.2192e-01,  1.5108e+00, -1.1469e-01, -1.4554e+00],
        [ 6.1144e-02,  7.3199e-01,  7.3373e-02, -3.1612e-01],
        [ 1.9058e-01,  1.3128e+00, -3.9148e-03, -1.0927e+00],
        [-3.2662e-02, -1.8011e-01,  3.0902e-02,  3.2445e-01],
        [-1.0478e-02, -1.7975e-01, -6.0892e-03,  3.1648e-01],
        [ 4.7386e-02,  8.3133e-01, -1.6717e-01, -1.4501e+00],
        [ 2.3502e-03,  7.3699e-01,  1.0391e-01, -4.2796e-01],
        [-2.4166e-04, -2.2275e-01,  5.1142e-02,  3.7374e-01],
        [-4.6394e-02, -4.3457e-01,  1.1288e-01,  7.3644e-01],
        [ 6.8068e-02,  4.3962e-01, -6.1639e-02, -6.1027e-01],
        [-7.2920e-03,  2.7683e-02, -9.8648e-04, -2.4419e-03],
        [ 2.6546e-01,  1.5088e+00, -6.3831e-02, -1.4074e+00],
        [-5.2322e-02,  5.5012e-01,  1.2807e-01, -3.1744e-01],
        [-2.6805e-02, -4.0172e-01,  3.0356e-02,  6.2475e-01],
        [-2.5162e-02, -3.7496e-01,  1.8678e-02,  6.1120e-01],
        [ 3.7983e-02,  1.1537e+00, -1.3846e-01, -1.8957e+00],
        [ 3.9257e-02, -2.1569e-01,  6.7202e-02,  5.6961e-01],
        [ 6.0309e-02,  1.0157e+00, -1.4460e-01, -1.6753e+00],
        [-3.1790e-02,  1.3482e-02,  3.3445e-02,  6.5509e-02],
        [-3.4244e-02, -4.3754e-01,  1.6175e-01,  1.1126e+00],
        [ 1.0952e-01,  1.4092e+00, -1.3833e-01, -2.1604e+00],
        [-3.1520e-02, -1.8210e-01,  3.4755e-02,  3.6855e-01],
        [-2.0769e-02, -2.3074e-01,  9.8553e-02,  5.5205e-01],
        [-1.6954e-03,  5.7179e-01,  2.4716e-02, -6.7189e-01],
        [-5.6196e-02,  3.3359e-01,  1.4941e-01, -1.6868e-01],
        [ 3.6127e-02,  1.7623e-01,  6.3119e-02, -5.3885e-02],
        [ 1.8258e-01,  1.1228e+00,  4.7180e-02, -8.7851e-01],
        [-4.9524e-02,  5.2630e-01,  1.4604e-01, -4.1075e-01],
        [-1.0784e-02,  1.5276e-02, -6.6071e-03,  2.5892e-02],
        [ 1.0620e-01,  6.3776e-01, -1.1701e-01, -9.7425e-01],
        [ 1.3770e-01,  1.6054e+00, -1.8154e-01, -2.4924e+00],
        [-2.1569e-02, -1.7967e-01,  1.2385e-02,  3.1463e-01],
        [-2.4281e-02,  1.5009e-02,  6.8833e-03,  3.1789e-02],
        [ 9.2003e-03, -4.2908e-01,  2.9062e-02,  6.1140e-01],
        [ 8.0622e-02,  8.2249e-01, -1.7811e-01, -1.4309e+00],
        [-3.8664e-02,  1.7396e-01, -2.0487e-03, -3.2688e-01],
        [-7.9457e-02, -2.1351e-01,  1.1906e-01,  4.8758e-01],
        [-4.4667e-02, -2.0743e-02,  2.7441e-05, -4.3369e-02],
        [ 5.4428e-02,  4.3823e-01, -4.4046e-02, -5.7906e-01],
        [ 8.2904e-02,  1.0977e+00,  4.3069e-02, -9.7669e-01],
        [ 1.3004e-01,  1.0108e+00, -2.0121e-01, -1.6604e+00],
        [-1.1873e-02, -4.3006e-01,  5.9552e-02,  6.3367e-01],
        [ 1.3795e-01,  5.7777e-01, -1.5642e-01, -1.0362e+00],
        [-1.0823e-02,  7.9069e-01,  1.5605e-02, -1.0333e+00],
        [ 2.0882e-02,  4.0251e-02, -1.0792e-02, -2.8917e-02],
        [-5.7973e-02, -5.1984e-02,  1.4156e-01,  3.1882e-01],
        [-3.2703e-03,  3.3895e-02, -4.1228e-02, -6.2195e-02],
        [ 3.4943e-02, -2.1571e-02,  7.8594e-02,  2.9884e-01],
        [ 7.1582e-02,  5.4641e-01,  1.1389e-01, -1.9807e-01],
        [ 2.1684e-01,  1.1177e+00, -2.5768e-02, -8.0122e-01],
        [-3.1605e-02,  1.5280e-01,  1.3503e-01,  1.1308e-01],
        [ 1.9491e-01,  1.5791e+00, -2.0274e-01, -2.4921e+00],
        [ 4.0735e-02, -2.1241e-01,  4.8793e-02,  4.9663e-01],
        [-5.2644e-03, -2.2430e-01,  6.0569e-02,  4.0820e-01],
        [-7.1832e-03, -1.8003e-01, -1.3060e-02,  3.2267e-01],
        [ 1.9717e-02, -3.9284e-01, -1.8533e-02,  5.4995e-01],
        [ 4.3242e-01,  2.2959e+00, -1.9818e-01, -2.7246e+00],
        [-6.7102e-02, -2.1072e-01,  9.5657e-02,  4.2452e-01],
        [ 2.3919e-01,  1.3132e+00, -4.1793e-02, -1.1019e+00],
        [ 5.2352e-02,  5.9933e-01,  1.3845e-02, -8.9700e-01],
        [ 1.0494e-01,  6.2334e-01, -6.7060e-02, -7.7024e-01],
        [-2.7302e-02, -3.9304e-01,  4.8487e-02,  5.5473e-01],
        [ 2.3188e-02,  3.9794e-02, -1.5792e-02, -1.8837e-02],
        [ 6.1058e-02,  9.6035e-01, -1.7637e-01, -1.6490e+00],
        [-3.9930e-02, -2.0874e-02, -4.1807e-03, -4.0477e-02],
        [ 2.0741e-01,  1.0223e+00, -2.0911e-01, -1.5771e+00],
        [ 2.3221e-02,  3.7635e-01,  2.4532e-02, -5.9369e-01],
        [ 1.3033e-01,  3.8099e-01, -1.4237e-01, -7.0231e-01],
        [ 7.5844e-02,  1.5720e+00, -1.0214e-01, -2.2294e+00],
        [-7.8406e-03,  2.2851e-01, -3.4351e-02, -3.4385e-01],
        [ 2.8878e-02,  6.1299e-01, -4.7538e-02, -8.7981e-01],
        [ 1.2722e-02,  8.0779e-01, -2.4242e-02, -1.1648e+00],
        [-1.3052e-02,  2.2765e-01, -2.7039e-02, -3.2481e-01],
        [ 2.6301e-02,  2.3327e-01,  2.9704e-02, -1.8744e-01],
        [ 9.0040e-02,  7.6855e-01, -8.6415e-02, -1.0032e+00],
        [ 1.4793e-01,  9.6767e-01, -1.6583e-01, -1.3973e+00],
        [ 1.4264e-01,  1.9639e+00, -1.9776e-01, -2.8855e+00],
        [ 4.0061e-02,  2.0994e-01,  3.2707e-02, -3.3046e-01]], device='cuda:0')</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1"></a>state_batch.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>torch.Size([128, 4])</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1"></a>action_batch.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>torch.Size([128, 1])</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1"></a>reward_batch</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>tensor([1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1.,
        1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1.,
        1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1.,
        1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1.,
        1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1.,
        1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1.,
        1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1.,
        1., 1.], device='cuda:0')</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1"></a>__t</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>tensor([[0.8239, 1.0678],
        [1.5102, 1.8625],
        [1.1531, 1.4095],
        [0.7606, 1.0270],
        [0.7679, 1.0549],
        [0.7800, 0.9981],
        [0.9312, 1.3687],
        [1.0128, 1.3304],
        [1.6723, 2.1253],
        [0.7289, 0.9694],
        [1.7867, 2.2589],
        [0.7771, 1.0487],
        [1.1555, 1.4792],
        [1.4739, 1.8754],
        [0.7970, 1.0090],
        [0.8166, 1.0341],
        [0.7520, 0.9775],
        [1.4251, 1.8186],
        [0.7406, 0.9626],
        [0.8206, 1.0935],
        [1.2606, 1.6089],
        [0.9438, 1.2157],
        [0.7455, 0.9680],
        [1.5628, 1.9837],
        [0.8967, 1.1652],
        [0.7654, 0.9682],
        [0.8783, 1.1400],
        [0.7707, 1.0308],
        [1.4016, 1.7157],
        [0.7585, 1.0263],
        [0.7604, 1.0498],
        [0.7715, 1.0034],
        [0.7650, 1.0434],
        [1.0396, 1.2708],
        [1.2695, 1.6362],
        [1.3621, 1.7203],
        [1.4564, 1.8477],
        [0.7637, 1.0681],
        [0.7436, 0.9637],
        [0.8141, 1.0474],
        [0.7496, 0.9662],
        [1.0074, 1.3075],
        [0.8058, 1.1415],
        [1.0222, 1.3213],
        [0.7964, 1.0206],
        [0.7444, 0.9654],
        [1.0712, 1.4032],
        [0.8287, 1.0278],
        [0.7791, 1.0071],
        [1.3797, 1.7582],
        [0.8031, 1.1290],
        [1.1220, 1.4722],
        [0.8581, 1.1328],
        [0.7458, 0.9692],
        [1.9925, 2.5241],
        [0.8844, 1.1042],
        [0.7859, 1.0129],
        [0.7419, 0.9734],
        [1.0514, 1.3672],
        [1.2441, 1.5828],
        [0.7758, 1.0221],
        [0.7502, 0.9799],
        [0.7625, 0.9714],
        [1.3229, 1.7080],
        [0.7379, 0.9676],
        [1.1362, 1.3960],
        [0.7507, 0.9510],
        [1.3220, 1.6228],
        [0.7775, 1.0539],
        [0.8222, 1.1699],
        [1.6477, 2.1127],
        [1.0839, 1.3923],
        [0.8092, 1.1518],
        [0.8763, 1.0864],
        [1.1191, 1.4253],
        [1.0011, 1.2350],
        [1.3038, 1.6590],
        [1.3925, 1.7687],
        [1.1646, 1.4218],
        [0.7395, 0.9621],
        [0.7741, 1.0439],
        [0.9269, 1.1422],
        [1.1394, 1.3959],
        [1.2993, 1.6673],
        [0.7799, 1.0119],
        [0.7707, 1.0735],
        [2.0438, 2.5919],
        [0.9913, 1.2691],
        [0.7499, 0.9620],
        [0.9051, 1.3184],
        [0.9155, 1.1439],
        [0.7461, 0.9607],
        [0.7499, 0.9686],
        [0.7532, 0.9851],
        [1.9530, 2.4456],
        [1.0390, 1.5443],
        [0.7440, 0.9491],
        [1.2709, 1.6259],
        [0.7590, 1.0258],
        [0.7634, 1.0303],
        [0.7521, 0.9729],
        [1.0305, 1.2570],
        [1.7204, 2.1211],
        [0.7467, 0.9588],
        [0.8260, 1.0523],
        [0.9137, 1.2058],
        [0.7448, 0.9628],
        [1.1614, 1.4941],
        [0.8785, 1.0930],
        [0.9300, 1.2236],
        [1.3657, 1.7324],
        [0.9146, 1.1254],
        [1.2236, 1.5748],
        [0.7643, 1.0162],
        [0.7571, 1.0082],
        [0.8118, 1.0476],
        [1.8991, 2.3756],
        [0.7402, 0.9630],
        [0.7951, 1.0291],
        [0.8198, 1.1739],
        [1.1728, 1.4595],
        [1.5033, 1.9224],
        [0.9975, 1.3053],
        [1.1705, 1.5177],
        [0.7491, 0.9692],
        [0.7720, 1.0358],
        [0.7649, 0.9644],
        [0.7320, 0.9879]], device='cuda:0', grad_fn=&lt;AddmmBackward0&gt;)</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1"></a>expected_state_action_values</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>tensor([2.2928, 1.9625, 1.4207, 2.1499, 1.4084, 1.4506, 1.4171, 1.4036, 1.8529,
        1.5080, 1.3836, 1.6617, 1.6917, 2.1036, 1.4724, 1.4929, 1.3812, 1.8639,
        1.4004, 1.3794, 1.3526, 1.6855, 1.7178, 1.3750, 1.5543, 1.0000, 1.4032,
        1.5156, 1.7385, 1.4519, 1.6601, 1.4305, 1.5354, 1.3849, 1.4020, 1.3803,
        1.4091, 1.6270, 1.4476, 1.4067, 1.3784, 1.4689, 1.3721, 1.3883, 1.4954,
        1.3855, 1.3683, 1.4826, 1.8911, 1.4277, 1.7251, 1.3977, 1.4022, 1.7976,
        1.4444, 1.4073, 1.4701, 1.4811, 1.3793, 1.8667, 1.4113, 1.4553, 1.4508,
        1.9791, 1.4284, 1.8901, 1.3705, 1.5423, 1.0000, 2.1070, 1.4011, 1.4223,
        1.4908, 1.3795, 1.0000, 1.3712, 1.6187, 1.4180, 1.3797, 1.6121, 2.2511,
        1.3996, 1.3766, 1.4590, 1.7936, 1.4091, 1.4084, 1.3822, 1.4698, 1.6433,
        1.9002, 1.4589, 1.6349, 1.6177, 1.3832, 1.3732, 1.3877, 1.3816, 1.3966,
        1.6092, 1.3519, 2.2492, 1.4199, 1.4088, 1.4035, 1.4505, 2.4448, 1.4024,
        1.7346, 1.5550, 1.5385, 1.4438, 1.3838, 1.8823, 1.3829, 1.8780, 1.4538,
        1.5172, 2.1501, 1.4165, 1.5649, 1.6701, 1.4123, 1.3880, 1.6303, 1.7996,
        2.4402, 1.4056], device='cuda:0')</code></pre>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://utteranc.es/client.js" repo="hoyeon1234/sin-hoyeon" issue-term="pathname" theme="github-light" crossorigin="anonymous" async="">
</script>
</div> <!-- /content -->



</body></html>